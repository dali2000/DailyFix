import{Na as f,Oa as v,a as r,b as o,j as n,n as g,p as a,s as h,v as p}from"./chunk-NLVE35WO.js";var y=(()=>{class c{constructor(t,e){this.authService=t,this.apiService=e,this.expenses=[],this.budgets=[],this.savingsGoals=[],this.salaries=[],this.authService.currentUser$.pipe(g()).subscribe(s=>{s!==null?this.loadAll():(this.expenses=[],this.budgets=[],this.savingsGoals=[],this.salaries=[])})}getExpenses(){return[...this.expenses]}getExpensesObservable(){return this.apiService.get("/finance/expenses").pipe(n(t=>t.data||[]),a(t=>this.expenses=t.map(e=>o(r({},e),{id:e.id.toString(),date:new Date(e.date)}))))}addExpense(t){return this.apiService.post("/finance/expenses",t).pipe(n(e=>e.data),a(e=>{this.expenses.push(o(r({},e),{id:e.id.toString(),date:new Date(e.date)}))}))}updateExpense(t,e){return this.apiService.put(`/finance/expenses/${t}`,e).pipe(n(s=>s.data),a(s=>{let i=this.expenses.findIndex(u=>u.id===t);i!==-1&&(this.expenses[i]=o(r({},s),{id:s.id.toString(),date:new Date(s.date)}))}))}deleteExpense(t){return this.apiService.delete(`/finance/expenses/${t}`).pipe(n(e=>e.success),a(()=>{let e=this.expenses.findIndex(s=>s.id===t);e!==-1&&this.expenses.splice(e,1)}))}getTotalExpenses(){return this.expenses.reduce((t,e)=>t+e.amount,0)}getExpensesByCategory(t){return this.expenses.filter(e=>e.category===t)}getBudgets(){return[...this.budgets]}getBudgetsObservable(){return this.apiService.get("/finance/budgets").pipe(n(t=>t.data||[]),a(t=>this.budgets=t.map(e=>o(r({},e),{id:e.id.toString()}))))}addBudget(t){return this.apiService.post("/finance/budgets",t).pipe(n(e=>e.data),a(e=>{this.budgets.push(o(r({},e),{id:e.id.toString()}))}))}updateBudget(t,e){return this.apiService.put(`/finance/budgets/${t}`,e).pipe(n(s=>s.data),a(s=>{let i=this.budgets.findIndex(u=>u.id===t);i!==-1&&(this.budgets[i]=o(r({},s),{id:s.id.toString()}))}))}deleteBudget(t){return this.apiService.delete(`/finance/budgets/${t}`).pipe(n(e=>e.success),a(()=>{let e=this.budgets.findIndex(s=>s.id===t);e!==-1&&this.budgets.splice(e,1)}))}getSavingsGoals(){return[...this.savingsGoals]}getSavingsGoalsObservable(){return this.apiService.get("/finance/savings-goals").pipe(n(t=>t.data||[]),a(t=>this.savingsGoals=t.map(e=>o(r({},e),{id:e.id.toString(),deadline:e.deadline?new Date(e.deadline):void 0}))))}updateSavingsGoal(t,e){return this.apiService.put(`/finance/savings-goals/${t}`,e).pipe(n(s=>s.data),a(s=>{let i=this.savingsGoals.findIndex(u=>u.id===t);i!==-1&&(this.savingsGoals[i]=o(r({},s),{id:s.id.toString(),deadline:s.deadline?new Date(s.deadline):void 0}))}))}deleteSavingsGoal(t){return this.apiService.delete(`/finance/savings-goals/${t}`).pipe(n(e=>e.success),a(()=>{let e=this.savingsGoals.findIndex(s=>s.id===t);e!==-1&&this.savingsGoals.splice(e,1)}))}getSalaries(){return[...this.salaries]}getSalariesObservable(){return this.apiService.get("/finance/salaries").pipe(n(t=>t.data||[]),a(t=>this.salaries=t.map(e=>o(r({},e),{id:e.id.toString(),date:new Date(e.date)}))))}addSalary(t){return this.apiService.post("/finance/salaries",t).pipe(n(e=>e.data),a(e=>{this.salaries.push(o(r({},e),{id:e.id.toString(),date:new Date(e.date)}))}))}updateSalary(t,e){return this.apiService.put(`/finance/salaries/${t}`,e).pipe(n(s=>s.data),a(s=>{let i=this.salaries.findIndex(u=>u.id===t);i!==-1&&(this.salaries[i]=o(r({},s),{id:s.id.toString(),date:new Date(s.date)}))}))}deleteSalary(t){return this.apiService.delete(`/finance/salaries/${t}`).pipe(n(e=>e.success),a(()=>{let e=this.salaries.findIndex(s=>s.id===t);e!==-1&&this.salaries.splice(e,1)}))}getTotalIncome(){return this.salaries.reduce((t,e)=>t+e.amount,0)}getTotalExpensesForMonth(t,e){return this.expenses.filter(s=>{let i=new Date(s.date);return i.getFullYear()===t&&i.getMonth()===e}).reduce((s,i)=>s+i.amount,0)}getMonthlySalary(){let t=new Date,s=this.salaries.filter(d=>{let l=new Date(d.date);return d.period==="monthly"&&l.getFullYear()===t.getFullYear()&&l.getMonth()===t.getMonth()}).reduce((d,l)=>d+l.amount,0),u=this.salaries.filter(d=>{let l=new Date(d.date);return d.period==="yearly"&&l.getFullYear()===t.getFullYear()}).reduce((d,l)=>d+l.amount/12,0);return s+u}getMonthlyBudget(){return this.budgets.filter(e=>e.period==="monthly").reduce((e,s)=>e+s.limit,0)}getRemainingBudget(){let t=new Date,e=this.getTotalExpensesForMonth(t.getFullYear(),t.getMonth());return this.getMonthlyBudget()-e}getRemainingBalance(){let t=this.getMonthlySalary(),e=new Date,s=this.getTotalExpensesForMonth(e.getFullYear(),e.getMonth());return t-s}getSavingsSuggestions(){let t=[],e=new Date,s=this.getTotalExpensesForMonth(e.getFullYear(),e.getMonth());return s>0&&(this.getExpensesByCategory("food").reduce((d,l)=>d+l.amount,0)>s*.3&&t.push("Consid\xE9rez r\xE9duire les d\xE9penses alimentaires en cuisinant plus \xE0 la maison"),this.getExpensesByCategory("leisure").reduce((d,l)=>d+l.amount,0)>s*.2&&t.push("R\xE9duisez les d\xE9penses de loisirs en cherchant des activit\xE9s gratuites")),t}addSavingsGoal(t){let e="currentAmount"in t?o(r({},t),{currentAmount:t.currentAmount||0}):o(r({},t),{currentAmount:0});return this.apiService.post("/finance/savings-goals",e).pipe(n(s=>s.data),a(s=>{this.savingsGoals.push(o(r({},s),{id:s.id.toString(),deadline:s.deadline?new Date(s.deadline):void 0}))}))}loadAll(){this.authService.isAuthenticated()?(this.getExpensesObservable().subscribe({error:t=>console.error("Error loading expenses:",t)}),this.getBudgetsObservable().subscribe({error:t=>console.error("Error loading budgets:",t)}),this.getSavingsGoalsObservable().subscribe({error:t=>console.error("Error loading savings goals:",t)}),this.getSalariesObservable().subscribe({error:t=>console.error("Error loading salaries:",t)})):(this.expenses=[],this.budgets=[],this.savingsGoals=[],this.salaries=[])}static{this.\u0275fac=function(e){return new(e||c)(p(v),p(f))}}static{this.\u0275prov=h({token:c,factory:c.\u0275fac,providedIn:"root"})}}return c})();export{y as a};
