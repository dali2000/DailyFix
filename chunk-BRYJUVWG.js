import{Aa as v,a,b as r,m as u,p as m}from"./chunk-TB66C4D3.js";var w=(()=>{class o{constructor(t){this.authService=t,this.meals=[],this.activities=[],this.sleepRecords=[],this.waterIntakes=[],this.meditationSessions=[],this.authService.currentUser$.subscribe(()=>{this.loadFromStorage()}),this.loadFromStorage()}getMeals(){return[...this.meals]}addMeal(t){let e=r(a({},t),{id:this.generateId()});return this.meals.push(e),this.saveToStorage(),e}deleteMeal(t){let e=this.meals.findIndex(i=>i.id===t);return e===-1?!1:(this.meals.splice(e,1),this.saveToStorage(),!0)}getMealsForDate(t){let e=t.toDateString();return this.meals.filter(i=>new Date(i.date).toDateString()===e)}getTodayCalories(){let t=new Date;return this.getMealsForDate(t).reduce((e,i)=>e+(i.calories||0),0)}getActivities(){return[...this.activities]}addActivity(t){let e=r(a({},t),{id:this.generateId()});return this.activities.push(e),this.saveToStorage(),e}deleteActivity(t){let e=this.activities.findIndex(i=>i.id===t);return e===-1?!1:(this.activities.splice(e,1),this.saveToStorage(),!0)}getActivitiesForDate(t){let e=t.toDateString();return this.activities.filter(i=>new Date(i.date).toDateString()===e)}getTodayActivityMinutes(){let t=new Date;return this.getActivitiesForDate(t).reduce((e,i)=>e+i.duration,0)}getSleepRecords(){return[...this.sleepRecords]}addSleepRecord(t){let e=(new Date(t.wakeTime).getTime()-new Date(t.sleepTime).getTime())/36e5,i=r(a({},t),{id:this.generateId(),hours:Math.round(e*10)/10});return this.sleepRecords.push(i),this.saveToStorage(),i}getLastSleepRecord(){return this.sleepRecords.length>0?this.sleepRecords.sort((t,e)=>new Date(e.date).getTime()-new Date(t.date).getTime())[0]:void 0}getWaterIntakes(){return[...this.waterIntakes]}addWaterIntake(t){let e=r(a({},t),{id:this.generateId()});return this.waterIntakes.push(e),this.saveToStorage(),e}getTodayWaterIntake(){let e=new Date().toDateString();return this.waterIntakes.filter(i=>new Date(i.date).toDateString()===e).reduce((i,n)=>i+n.amount,0)}getMeditationSessions(){return[...this.meditationSessions]}addMeditationSession(t){let e=r(a({},t),{id:this.generateId()});return this.meditationSessions.push(e),this.saveToStorage(),e}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}saveToStorage(){let t=this.authService.getUserStorageKey("meals"),e=this.authService.getUserStorageKey("activities"),i=this.authService.getUserStorageKey("sleep"),n=this.authService.getUserStorageKey("water"),c=this.authService.getUserStorageKey("meditation");localStorage.setItem(t,JSON.stringify(this.meals)),localStorage.setItem(e,JSON.stringify(this.activities)),localStorage.setItem(i,JSON.stringify(this.sleepRecords)),localStorage.setItem(n,JSON.stringify(this.waterIntakes)),localStorage.setItem(c,JSON.stringify(this.meditationSessions))}loadFromStorage(){let t=this.authService.getUserStorageKey("meals"),e=this.authService.getUserStorageKey("activities"),i=this.authService.getUserStorageKey("sleep"),n=this.authService.getUserStorageKey("water"),c=this.authService.getUserStorageKey("meditation"),d=localStorage.getItem(t),h=localStorage.getItem(e),g=localStorage.getItem(i),S=localStorage.getItem(n),l=localStorage.getItem(c);d&&(this.meals=JSON.parse(d).map(s=>r(a({},s),{date:new Date(s.date)}))),h&&(this.activities=JSON.parse(h).map(s=>r(a({},s),{date:new Date(s.date)}))),g&&(this.sleepRecords=JSON.parse(g).map(s=>r(a({},s),{date:new Date(s.date),sleepTime:new Date(s.sleepTime),wakeTime:new Date(s.wakeTime)}))),S&&(this.waterIntakes=JSON.parse(S).map(s=>r(a({},s),{date:new Date(s.date)}))),l&&(this.meditationSessions=JSON.parse(l).map(s=>r(a({},s),{date:new Date(s.date)})))}static{this.\u0275fac=function(e){return new(e||o)(m(v))}}static{this.\u0275prov=u({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{w as a};
