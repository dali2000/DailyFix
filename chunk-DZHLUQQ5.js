import{Aa as h,a as r,b as i,m as d,p as u}from"./chunk-TB66C4D3.js";var S=(()=>{class o{constructor(t){this.authService=t,this.tasks=[],this.events=[],this.authService.currentUser$.subscribe(()=>{this.loadFromStorage()}),this.loadFromStorage()}getTasks(){return[...this.tasks]}getTaskById(t){return this.tasks.find(e=>e.id===t)}addTask(t){let e=i(r({},t),{id:this.generateId(),status:t.status||"todo",priority:t.priority||"medium",createdAt:new Date,updatedAt:new Date});return this.tasks.push(e),this.saveToStorage(),e}updateTask(t,e){let s=this.tasks.findIndex(n=>n.id===t);return s===-1?null:(this.tasks[s]=i(r(r({},this.tasks[s]),e),{updatedAt:new Date}),this.saveToStorage(),this.tasks[s])}deleteTask(t){let e=this.tasks.findIndex(s=>s.id===t);return e===-1?!1:(this.tasks.splice(e,1),this.saveToStorage(),!0)}getTasksForDate(t){let e=t.toDateString();return this.tasks.filter(s=>s.dueDate&&new Date(s.dueDate).toDateString()===e)}getTasksByStatus(t){return this.tasks.filter(e=>e.status===t)}updateTaskStatus(t,e){return this.updateTask(t,{status:e})}getCompletedTasksCount(){return this.tasks.filter(t=>t.completed).length}getTotalTasksCount(){return this.tasks.length}getEvents(){return[...this.events]}addEvent(t){let e=i(r({},t),{id:this.generateId()});return this.events.push(e),this.saveToStorage(),e}updateEvent(t,e){let s=this.events.findIndex(n=>n.id===t);return s===-1?null:(this.events[s]=r(r({},this.events[s]),e),this.saveToStorage(),this.events[s])}deleteEvent(t){let e=this.events.findIndex(s=>s.id===t);return e===-1?!1:(this.events.splice(e,1),this.saveToStorage(),!0)}getEventsForDate(t){let e=t.toDateString();return this.events.filter(s=>new Date(s.startDate).toDateString()===e)}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}saveToStorage(){let t=this.authService.getUserStorageKey("tasks"),e=this.authService.getUserStorageKey("events");localStorage.setItem(t,JSON.stringify(this.tasks)),localStorage.setItem(e,JSON.stringify(this.events))}loadFromStorage(){let t=this.authService.getUserStorageKey("tasks"),e=this.authService.getUserStorageKey("events"),s=localStorage.getItem(t),n=localStorage.getItem(e);s&&(this.tasks=JSON.parse(s).map(a=>i(r({},a),{status:a.status||(a.completed?"done":"todo"),priority:a.priority||"medium",dueDate:a.dueDate?new Date(a.dueDate):void 0,reminder:a.reminder?new Date(a.reminder):void 0,createdAt:new Date(a.createdAt),updatedAt:a.updatedAt?new Date(a.updatedAt):new Date(a.createdAt)}))),n&&(this.events=JSON.parse(n).map(a=>i(r({},a),{startDate:new Date(a.startDate),endDate:a.endDate?new Date(a.endDate):void 0})))}static{this.\u0275fac=function(e){return new(e||o)(u(h))}}static{this.\u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{S as a};
