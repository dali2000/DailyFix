import{Aa as d,a,b as n,m as h,p as u}from"./chunk-TB66C4D3.js";var g=(()=>{class r{constructor(s){this.authService=s,this.shoppingLists=[],this.householdTasks=[],this.authService.currentUser$.subscribe(()=>{this.loadFromStorage()}),this.loadFromStorage()}getShoppingLists(){return[...this.shoppingLists]}getShoppingListById(s){return this.shoppingLists.find(e=>e.id===s)}addShoppingList(s){let e=n(a({},s),{id:this.generateId(),createdAt:new Date});return this.shoppingLists.push(e),this.saveToStorage(),e}updateShoppingList(s,e){let t=this.shoppingLists.findIndex(i=>i.id===s);return t===-1?null:(this.shoppingLists[t]=a(a({},this.shoppingLists[t]),e),this.saveToStorage(),this.shoppingLists[t])}deleteShoppingList(s){let e=this.shoppingLists.findIndex(t=>t.id===s);return e===-1?!1:(this.shoppingLists.splice(e,1),this.saveToStorage(),!0)}addItemToList(s,e){let t=this.getShoppingListById(s);if(!t)return null;let i=n(a({},e),{id:this.generateId()});return t.items.push(i),this.saveToStorage(),i}toggleItemPurchase(s,e){let t=this.getShoppingListById(s);if(!t)return!1;let i=t.items.find(o=>o.id===e);return i?(i.purchased=!i.purchased,this.saveToStorage(),!0):!1}getHouseholdTasks(){return[...this.householdTasks]}addHouseholdTask(s){let e=n(a({},s),{id:this.generateId()});return this.calculateNextDueDate(e),this.householdTasks.push(e),this.saveToStorage(),e}updateHouseholdTask(s,e){let t=this.householdTasks.findIndex(i=>i.id===s);return t===-1?null:(this.householdTasks[t]=a(a({},this.householdTasks[t]),e),e.completed&&(this.householdTasks[t].lastCompleted=new Date,this.calculateNextDueDate(this.householdTasks[t])),this.saveToStorage(),this.householdTasks[t])}deleteHouseholdTask(s){let e=this.householdTasks.findIndex(t=>t.id===s);return e===-1?!1:(this.householdTasks.splice(e,1),this.saveToStorage(),!0)}getUpcomingHouseholdTasks(){let s=new Date;return this.householdTasks.filter(e=>!e.completed&&e.nextDueDate&&new Date(e.nextDueDate)>=s).sort((e,t)=>{let i=e.nextDueDate?new Date(e.nextDueDate).getTime():0,o=t.nextDueDate?new Date(t.nextDueDate).getTime():0;return i-o})}calculateNextDueDate(s){if(s.frequency==="one-time"&&s.dueDate){s.nextDueDate=s.dueDate;return}let e=s.lastCompleted||new Date,t=new Date(e);switch(s.frequency){case"daily":t.setDate(t.getDate()+1);break;case"weekly":t.setDate(t.getDate()+7);break;case"monthly":t.setMonth(t.getMonth()+1);break}s.nextDueDate=t}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}saveToStorage(){let s=this.authService.getUserStorageKey("shoppingLists"),e=this.authService.getUserStorageKey("householdTasks");localStorage.setItem(s,JSON.stringify(this.shoppingLists)),localStorage.setItem(e,JSON.stringify(this.householdTasks))}loadFromStorage(){let s=this.authService.getUserStorageKey("shoppingLists"),e=this.authService.getUserStorageKey("householdTasks"),t=localStorage.getItem(s),i=localStorage.getItem(e);t&&(this.shoppingLists=JSON.parse(t).map(o=>n(a({},o),{createdAt:new Date(o.createdAt)}))),i&&(this.householdTasks=JSON.parse(i).map(o=>n(a({},o),{dueDate:o.dueDate?new Date(o.dueDate):void 0,lastCompleted:o.lastCompleted?new Date(o.lastCompleted):void 0,nextDueDate:o.nextDueDate?new Date(o.nextDueDate):void 0})))}static{this.\u0275fac=function(e){return new(e||r)(u(d))}}static{this.\u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{g as a};
