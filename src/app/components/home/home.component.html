<div class="home-page">
  <header class="home-hero">
    <div class="home-hero-icon" aria-hidden="true">ğŸ‘‹</div>
    <div class="home-hero-text">
      <h1 class="home-title">{{ 'home.greeting' | translate }} {{ userName || ('common.user' | translate) }} !</h1>
      <p class="home-subtitle">{{ 'home.ready' | translate }}</p>
    </div>
  </header>

  <!-- Conseils du jour -->
  <div *ngIf="showDailyAdviceCard && !dailyAdviceError" class="daily-advice-card">
    <div class="daily-advice-header">
      <span class="daily-advice-icon" aria-hidden="true">ğŸ’¡</span>
      <h3>{{ 'home.dailyAdviceTitle' | translate }}</h3>
    </div>
    <p *ngIf="dailyAdviceLoading" class="daily-advice-loading">{{ 'home.dailyAdviceLoading' | translate }}</p>
    <div *ngIf="dailyAdvice && !dailyAdviceLoading" class="daily-advice-text" [innerText]="dailyAdvice"></div>
    <p *ngIf="!dailyAdvice && !dailyAdviceLoading" class="daily-advice-hint">{{ 'home.dailyAdviceHint' | translate }}</p>
  </div>

  <!-- Statistiques de l'Application (liste dÃ©roulante) -->
  <section class="stats-section stats-section-dropdown" aria-labelledby="stats-heading">
    <button type="button" class="stats-section-toggle" (click)="toggleStatsSection()" [attr.aria-expanded]="statsSectionExpanded" [attr.aria-controls]="'stats-content'" id="stats-heading">
      <span class="stats-section-icon" aria-hidden="true">ğŸ“ˆ</span>
      <span class="stats-section-title-text">{{ 'home.appStats' | translate }}</span>
      <span class="stats-section-chevron" aria-hidden="true">{{ statsSectionExpanded ? 'â–¼' : 'â–¶' }}</span>
    </button>
    <div id="stats-content" class="stats-section-content" [class.stats-section-content-open]="statsSectionExpanded" [attr.aria-hidden]="!statsSectionExpanded">
    <div class="stats-grid">
      <div class="stat-item stat-item--expenses">
        <div class="stat-icon"><span aria-hidden="true">ğŸ’¸</span></div>
        <div class="stat-info">
          <span class="stat-label">{{ 'home.totalExpenses' | translate }}</span>
          <span class="stat-value">{{ currencySymbol }}{{ totalExpenses | number:'1.0-0' }}</span>
        </div>
      </div>
      <div class="stat-item stat-item--goals">
        <div class="stat-icon"><span aria-hidden="true">ğŸ¯</span></div>
        <div class="stat-info">
          <span class="stat-label">{{ 'home.savingsGoals' | translate }}</span>
          <span class="stat-value">{{ totalSavingsGoals }}</span>
        </div>
      </div>
      <div class="stat-item stat-item--active">
        <div class="stat-icon"><span aria-hidden="true">âœ…</span></div>
        <div class="stat-info">
          <span class="stat-label">{{ 'home.activeGoals' | translate }}</span>
          <span class="stat-value">{{ activeSavingsGoals }}</span>
        </div>
      </div>
      <div class="stat-item stat-item--health">
        <div class="stat-icon"><span aria-hidden="true">â¤ï¸</span></div>
        <div class="stat-info">
          <span class="stat-label">{{ 'home.healthRecords' | translate }}</span>
          <span class="stat-value">{{ totalHealthRecords }}</span>
        </div>
      </div>
      <div class="stat-item stat-item--events">
        <div class="stat-icon"><span aria-hidden="true">ğŸ“…</span></div>
        <div class="stat-info">
          <span class="stat-label">{{ 'home.socialEventsCount' | translate }}</span>
          <span class="stat-value">{{ totalSocialEvents }}</span>
        </div>
      </div>
      <div class="stat-item stat-item--tasks">
        <div class="stat-icon"><span aria-hidden="true">âœ“</span></div>
        <div class="stat-info">
          <span class="stat-label">{{ 'home.totalTasks' | translate }}</span>
          <span class="stat-value">{{ totalTasks }}</span>
        </div>
      </div>
    </div>
    </div>
  </section>

  <!-- Vue d'ensemble (4 cartes) en liste dÃ©roulante -->
  <section class="overview-section overview-section-dropdown" aria-labelledby="overview-heading">
    <button type="button" class="overview-section-toggle" (click)="toggleOverviewSection()" [attr.aria-expanded]="overviewSectionExpanded" [attr.aria-controls]="'overview-content'" id="overview-heading">
      <span class="overview-section-icon" aria-hidden="true">ğŸ“‹</span>
      <span class="overview-section-title-text">{{ 'home.overviewSection' | translate }}</span>
      <span class="overview-section-chevron" aria-hidden="true">{{ overviewSectionExpanded ? 'â–¼' : 'â–¶' }}</span>
    </button>
    <div id="overview-content" class="overview-section-content" [class.overview-section-content-open]="overviewSectionExpanded" [attr.aria-hidden]="!overviewSectionExpanded">
  <div class="cards-container">
    <div class="stats-card stats-card--blue">
      <div class="stats-card-icon-wrap stats-card-icon-wrap--blue"><span class="stats-card-emoji" aria-hidden="true">âœ“</span></div>
      <div class="stats-card-content">
        <span class="stats-card-label">{{ 'home.todayTasks' | translate }}</span>
        <span class="stats-card-value">{{ todayHouseholdTasksCount + shoppingListsCount }}</span>
        <span class="stats-card-subtitle" *ngIf="todayHouseholdTasksCount > 0 || shoppingListsCount > 0">
          <span *ngIf="todayHouseholdTasksCount > 0">{{ todayHouseholdTasksCount }} {{ 'home.householdTasks' | translate }}</span>
          <span *ngIf="todayHouseholdTasksCount > 0 && shoppingListsCount > 0"> Â· </span>
          <span *ngIf="shoppingListsCount > 0">{{ shoppingListsCount }} {{ 'home.shoppingLists' | translate }}</span>
        </span>
        <span class="stats-card-subtitle" *ngIf="todayHouseholdTasksCount === 0 && shoppingListsCount === 0">
          {{ 'home.noTasksOrLists' | translate }}
        </span>
      </div>
    </div>
    <div class="stats-card stats-card--green">
      <div class="stats-card-icon-wrap stats-card-icon-wrap--green"><span class="stats-card-emoji" aria-hidden="true">â¤ï¸</span></div>
      <div class="stats-card-content">
        <span class="stats-card-label">{{ 'home.healthScore' | translate }}</span>
        <span class="stats-card-value">{{ healthScore }}%</span>
      </div>
    </div>
    <div class="stats-card stats-card--purple">
      <div class="stats-card-icon-wrap stats-card-icon-wrap--purple"><span class="stats-card-emoji" aria-hidden="true">ğŸ’°</span></div>
      <div class="stats-card-content">
        <span class="stats-card-label">{{ 'home.remainingBalance' | translate }}</span>
        <span class="stats-card-value" [class.negative]="remainingBalance < 0">{{ currencySymbol }}{{ remainingBalance | number:'1.0-0' }}</span>
      </div>
    </div>
    <div class="stats-card stats-card--orange">
      <div class="stats-card-icon-wrap stats-card-icon-wrap--orange"><span class="stats-card-emoji" aria-hidden="true">ğŸ“…</span></div>
      <div class="stats-card-content">
        <span class="stats-card-label">{{ 'home.events' | translate }}</span>
        <span class="stats-card-value">{{ upcomingEventsCount }}</span>
      </div>
    </div>
  </div>
    </div>
  </section>

  <div class="dashboard">
    <article class="dash-card">
      <div class="dash-card-header">
        <div class="dash-card-icon blue1">âœ”</div>
        <div class="dash-card-heading">
          <h3>{{ 'home.taskManagement' | translate }}</h3>
          <small>{{ 'home.taskManagementDesc' | translate }}</small>
        </div>
      </div>
      <div class="dash-card-body">
        <p class="dash-card-meta">{{ 'home.completedToday' | translate }} {{ tasksCompletedToday }}/{{ totalTasks }} ({{ 'home.total' | translate }}: {{ tasksCompleted }})</p>
        <div class="progress progress-thin">
          <div class="progress-bar" [style.width.%]="totalTasks ? (tasksCompleted / totalTasks) * 100 : 0"></div>
        </div>
        <button type="button" class="dash-card-btn" (click)="navigateTo('/tasks')">{{ 'home.manageTasks' | translate }}</button>
      </div>
    </article>

    <article class="dash-card">
      <div class="dash-card-header">
        <div class="dash-card-icon green1">â¤</div>
        <div class="dash-card-heading">
          <h3>{{ 'home.healthTracking' | translate }}</h3>
          <small>{{ 'home.healthTrackingDesc' | translate }}</small>
        </div>
      </div>
      <div class="dash-card-body">
        <p>{{ 'home.mealsToday' | translate }}: {{ todayMealsCount }} ({{ todayCalories }} kcal)</p>
        <p>{{ 'home.waterConsumed' | translate }}: {{ todayWaterLiters | number:'1.1-1' }} L</p>
        <p>{{ 'home.activity' | translate }}: {{ todayActivityMinutes }} min</p>
        <p>{{ 'home.lastSleep' | translate }}: {{ lastSleepHours != null ? (lastSleepHours + 'h') : 'â€”' }}</p>
        <button type="button" class="dash-card-btn" (click)="navigateTo('/health')">{{ 'home.updateHealth' | translate }}</button>
      </div>
    </article>

    <article class="dash-card">
      <div class="dash-card-header">
        <div class="dash-card-icon purple1">ğŸ’²</div>
        <div class="dash-card-heading">
          <h3>{{ 'home.finances' | translate }}</h3>
          <small>{{ 'home.financesDesc' | translate }}</small>
        </div>
      </div>
      <div class="dash-card-body">
        <p>{{ 'home.expensesThisMonth' | translate }}: {{ currencySymbol }}{{ monthlyExpenses | number:'1.0-0' }}</p>
        <p [class.green-text]="remainingBalance >= 0" [class.red-text]="remainingBalance < 0">
          {{ 'home.remainingBalance' | translate }}: {{ currencySymbol }}{{ remainingBalance | number:'1.0-0' }}
        </p>
        <div class="progress progress-thin">
          <div class="progress-bar grey1"></div>
        </div>
        <button type="button" class="dash-card-btn dash-card-btn-primary" (click)="navigateTo('/finance')">{{ 'home.addExpense' | translate }}</button>
      </div>
    </article>

    <article class="dash-card">
      <div class="dash-card-header">
        <div class="dash-card-icon yellow1">ğŸ </div>
        <div class="dash-card-heading">
          <h3>{{ 'home.domesticOrg' | translate }}</h3>
          <small>{{ 'home.domesticOrgDesc' | translate }}</small>
        </div>
      </div>
      <div class="dash-card-body">
        <ul class="dash-card-list">
          <li *ngFor="let task of upcomingHouseTasks">{{ task.name }} {{ task.date }}</li>
        </ul>
        <button type="button" class="dash-card-btn" (click)="navigateTo('/home-org')">{{ 'home.planTask' | translate }}</button>
      </div>
    </article>

    <article class="dash-card">
      <div class="dash-card-header">
        <div class="dash-card-icon orange1">ğŸ“…</div>
        <div class="dash-card-heading">
          <h3>{{ 'home.socialEvents' | translate }}</h3>
          <small>{{ 'home.socialEventsDesc' | translate }}</small>
        </div>
      </div>
      <div class="dash-card-body">
        <ul class="dash-card-list">
          <li *ngFor="let event of upcomingEvents">{{ event.name }} {{ event.date }}</li>
        </ul>
        <button type="button" class="dash-card-btn" (click)="navigateTo('/social')">{{ 'home.newEvent' | translate }}</button>
      </div>
    </article>

    <article class="dash-card">
      <div class="dash-card-header">
        <div class="dash-card-icon violet1">ğŸ¯</div>
        <div class="dash-card-heading">
          <h3>{{ 'home.personalDev' | translate }}</h3>
          <small>{{ 'home.personalDevDesc' | translate }}</small>
        </div>
      </div>
      <div class="dash-card-body">
        <ul class="dash-card-list">
          <li *ngFor="let goal of personalGoals">{{ goal.name }} <span [class.done]="goal.done">âœ”</span></li>
        </ul>
        <button type="button" class="dash-card-btn" (click)="navigateTo('/wellness')">{{ 'home.newGoal' | translate }}</button>
      </div>
    </article>
  </div>

  <!-- Charts Section -->
  <section class="charts-section">
    <div class="chart-card chart-card--tasks">
      <div class="chart-header">
        <h3 class="chart-title"><span class="chart-title-icon" aria-hidden="true">ğŸ“Š</span> {{ 'home.taskProgress' | translate }}</h3>
      </div>
      <div class="chart-content chart-content--split">
        <div class="task-status-chart">
          <div *ngFor="let item of taskStatusData" class="status-bar-item">
            <div class="status-row">
              <span class="status-name">{{ item.status }}</span>
              <span class="status-meta">{{ item.count }} Â· {{ item.percentage | number:'1.0-0' }}%</span>
            </div>
            <div class="status-bar">
              <div class="status-bar-fill" [style.width.%]="item.percentage" [class]="'status-' + item.status.toLowerCase().replace(' ', '-').replace('_', '-')"></div>
            </div>
          </div>
        </div>
        <div class="task-progress-circle">
          <div class="progress-circle" [style.--progress]="taskProgressPercentage + '%'">
            <svg viewBox="0 0 100 100" aria-hidden="true">
              <circle cx="50" cy="50" r="45" class="progress-bg"></circle>
              <circle cx="50" cy="50" r="45" class="progress-fill" [style.stroke-dashoffset]="283 - (283 * taskProgressPercentage / 100)"></circle>
            </svg>
            <div class="progress-text">
              <span class="progress-value">{{ taskProgressPercentage | number:'1.0-0' }}%</span>
              <span class="progress-label">{{ 'home.completed' | translate }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="chart-card chart-card--expenses">
      <div class="chart-header chart-header-with-month">
        <h3 class="chart-title"><span class="chart-title-icon" aria-hidden="true">ğŸ’°</span> {{ 'finance.expensesByCategory' | translate }}</h3>
        <div class="chart-month-switcher">
          <button type="button" class="month-btn month-prev" (click)="goToPrevExpenseChartMonth()" [attr.aria-label]="'common.previous' | translate" title="{{ 'common.previous' | translate }}">â€¹</button>
          <span class="chart-month-label">{{ expenseChartMonthLabel }}</span>
          <button type="button" class="month-btn month-next" (click)="goToNextExpenseChartMonth()" [disabled]="!canGoToNextExpenseChartMonth" [attr.aria-label]="'common.next' | translate" title="{{ 'common.next' | translate }}">â€º</button>
          <button type="button" class="month-btn month-current" (click)="goToCurrentExpenseChartMonth()">{{ 'finance.thisMonth' | translate }}</button>
        </div>
      </div>
      <div class="chart-content">
        <div class="expense-category-chart">
          <div *ngFor="let item of expenseCategoryData" class="category-bar-item">
            <div class="category-row">
              <span class="category-name">{{ item.category }}</span>
              <span class="category-amount">{{ currencySymbol }}{{ item.amount | number:'1.0-0' }}</span>
            </div>
            <div class="category-bar">
              <div class="category-bar-fill" [style.width.%]="item.percentage"></div>
            </div>
            <span class="category-percentage">{{ item.percentage | number:'1.0-0' }}%</span>
          </div>
        </div>
      </div>
    </div>

    <div class="chart-card chart-card--history">
      <div class="chart-header">
        <h3 class="chart-title"><span class="chart-title-icon" aria-hidden="true">ğŸ“ˆ</span> {{ 'home.expenseEvolution' | translate }}</h3>
      </div>
      <div class="chart-content">
        <div class="expense-history-chart">
          <div class="history-bars" *ngIf="monthlyExpenseHistory.length > 0">
            <div *ngFor="let item of monthlyExpenseHistory" class="history-bar-item">
              <div class="history-bar" [style.height.%]="getMaxExpense() > 0 ? (item.amount / getMaxExpense()) * 100 : 0">
                <span class="history-amount">{{ currencySymbol }}{{ item.amount | number:'1.0-0' }}</span>
              </div>
              <span class="history-month">{{ item.month }}</span>
            </div>
          </div>
          <div *ngIf="monthlyExpenseHistory.length === 0" class="chart-no-data">
            <span class="chart-no-data-icon" aria-hidden="true">ğŸ“Š</span>
            <p>{{ 'common.noData' | translate }}</p>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
