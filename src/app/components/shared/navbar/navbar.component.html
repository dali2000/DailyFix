<nav class="navbar" [class.navbar-rtl]="isRtl" [attr.dir]="isRtl ? 'rtl' : null">
  <div class="navbar-left">
    <button class="menu-btn" *ngIf="isMobile" (click)="toggleSidebar()" aria-label="Menu">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
    <a class="brand" routerLink="/home" aria-label="DailyFix home">DailyFix</a>
    <span class="badge">{{ 'navbar.freeVersion' | translate }}</span>
    <!-- Weather Widget -->
    <div class="weather-widget" *ngIf="weather && !weatherLoading">
      <span class="weather-icon">{{ weather.icon }}</span>
      <div class="weather-info">
        <span class="weather-temp">{{ weather.temperature }}°C</span>
        <span class="weather-city">{{ weather.city }}</span>
      </div>
      <!-- Version compacte pour mobile (affichée via CSS) -->
      <span class="weather-temp-mobile">{{ weather.temperature }}°C</span>
    </div>
    <div class="weather-widget weather-loading" *ngIf="weatherLoading">
      <span>{{ 'common.loading' | translate }}</span>
    </div>
  </div>
  <div class="navbar-right">
    <app-notifications></app-notifications>
    <button *ngIf="!hideFullscreen" class="icon-btn" [attr.aria-label]="isFullscreen ? ('navbar.exitFullscreen' | translate) : ('navbar.fullscreen' | translate)" [title]="isFullscreen ? ('navbar.exitFullscreen' | translate) : ('navbar.fullscreen' | translate)" (click)="toggleFullscreen()">
      <!-- Plein écran -->
      <svg *ngIf="!isFullscreen" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
      </svg>
      <!-- Quitter plein écran -->
      <svg *ngIf="isFullscreen" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/>
      </svg>
    </button>
    <div class="lang-container">
      <button class="icon-btn" type="button" [attr.aria-label]="'navbar.changeLanguage' | translate" [title]="'navbar.changeLanguage' | translate" (click)="toggleLangDropdown()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="2" y1="12" x2="22" y2="12"></line>
          <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
        </svg>
      </button>
      <div class="lang-dropdown" *ngIf="showLangDropdown">
        <button type="button" class="dropdown-item lang-item" *ngFor="let opt of langOptions" (click)="setLanguage(opt.code)" [class.active]="currentLang === opt.code">
          <span class="lang-label">{{ opt.label }}</span>
          <span class="lang-code">{{ opt.code | uppercase }}</span>
        </button>
      </div>
    </div>
    <button class="icon-btn theme-toggle-btn" aria-label="Toggle theme" [title]="(currentTheme === 'dark' ? 'navbar.themeLight' : 'navbar.themeDark') | translate" (click)="toggleTheme()">
      <!-- Soleil en mode sombre (cliquer → passer en clair) -->
      <svg *ngIf="currentTheme === 'dark'" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="5"></circle>
        <line x1="12" y1="1" x2="12" y2="3"></line>
        <line x1="12" y1="21" x2="12" y2="23"></line>
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
        <line x1="1" y1="12" x2="3" y2="12"></line>
        <line x1="21" y1="12" x2="23" y2="12"></line>
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
      </svg>
      <!-- Lune pour light / bleu / forêt / violet (cliquer → passer en sombre) -->
      <svg *ngIf="currentTheme !== 'dark'" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
      </svg>
    </button>
    <div class="profile-container">
      <div class="profile" 
           role="button" 
           tabindex="0" 
           [attr.aria-label]="'navbar.userAccount' | translate"
           (click)="toggleProfileDropdown()">
        <div class="avatar" [class.has-photo]="currentUser?.profilePhoto">
          <img *ngIf="currentUser?.profilePhoto" [src]="currentUser?.profilePhoto" alt="" class="avatar-img">
          <span *ngIf="!currentUser?.profilePhoto">{{ userInitials }}</span>
        </div>
        <span class="name">{{ userName }}</span>
        <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 4.5L6 7.5L9 4.5"/>
        </svg>
      </div>
      <div class="profile-dropdown" *ngIf="showProfileDropdown">
        <div class="dropdown-item" *ngIf="isAdmin" routerLink="/admin" (click)="closeProfileDropdown()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="9" y1="3" x2="9" y2="21"></line>
            <line x1="3" y1="9" x2="21" y2="9"></line>
          </svg>
          <span>{{ 'navbar.adminDashboard' | translate }}</span>
        </div>
        <div class="dropdown-item" routerLink="/settings" (click)="closeProfileDropdown()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M19.14,12.94a7.43,7.43,0,0,0,.05-.94,7.43,7.43,0,0,0-.05-.94l2.11-1.65a.5.5,0,0,0,.12-.64L19.8,5.27a.5.5,0,0,0-.6-.22l-2.49,1a7.08,7.08,0,0,0-1.63-.94l-.38-2.65A.5.5,0,0,0,14.21,2H9.79a.5.5,0,0,0-.49.42L8.92,5.07a7.08,7.08,0,0,0-1.63.94l-2.49-1a.5.5,0,0,0-.6.22L2.63,8.77a.5.5,0,0,0,.12.64L4.86,11.06a7.43,7.43,0,0,0-.05.94,7.43,7.43,0,0,0,.05.94L2.75,14.59a.5.5,0,0,0-.12.64l1.57,2.86a.5.5,0,0,0,.6.22l2.49-1a7.08,7.08,0,0,0,1.63.94l.38,2.65a.5.5,0,0,0,.49.42h4.42a.5.5,0,0,0,.49-.42l.38-2.65a7.08,7.08,0,0,0,1.63-.94l2.49,1a.5.5,0,0,0,.6-.22l1.57-2.86a.5.5,0,0,0-.12-.64ZM12,15.5A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z"/>
          </svg>
          <span>{{ 'navbar.settings' | translate }}</span>
        </div>
        <div class="dropdown-item" (click)="logout()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
            <polyline points="16 17 21 12 16 7"></polyline>
            <line x1="21" y1="12" x2="9" y2="12"></line>
          </svg>
          <span>{{ 'nav.logout' | translate }}</span>
        </div>
      </div>
    </div>
  </div>
</nav>
