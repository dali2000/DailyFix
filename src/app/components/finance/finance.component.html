<div class="finance-page">
  <h1>üí∞ Mon Portefeuille</h1>

  <div class="tabs">
    <button [class.active]="activeTab === 'overview'" (click)="activeTab = 'overview'">Vue d'ensemble</button>
    <button [class.active]="activeTab === 'salary'" (click)="activeTab = 'salary'">Salaire</button>
    <button [class.active]="activeTab === 'expenses'" (click)="activeTab = 'expenses'">D√©penses</button>
    <button [class.active]="activeTab === 'budget'" (click)="activeTab = 'budget'">Budget</button>
    <button [class.active]="activeTab === 'savings'" (click)="activeTab = 'savings'">√âpargne</button>
  </div>

  <!-- Overview Tab -->
  <div *ngIf="activeTab === 'overview'" class="tab-content">
    <!-- Bank Card -->
    <div class="bank-card" [class.negative-balance]="remainingBalance < 0">
      <div class="card-chip"></div>
      <div class="card-logo">DailyFix</div>
      <div class="card-number">{{ cardNumber }}</div>
      <div class="card-details">
        <div class="card-name-section">
          <div class="card-label">Titulaire</div>
          <div class="card-name">{{ userName }}</div>
        </div>
        <div class="card-expiry-section">
          <div class="card-label">Expire</div>
          <div class="card-expiry">{{ expiryDate }}</div>
        </div>
      </div>
      <div class="card-rib-section">
        <div class="card-label">RIB</div>
        <div class="card-rib">{{ rib }}</div>
      </div>
      <div class="card-balance">
        <div class="balance-label">Solde disponible</div>
        <div class="balance-amount" [class.negative]="remainingBalance < 0">
          {{ remainingBalance | number:'1.2-2' }} ‚Ç¨
        </div>
      </div>
    </div>

    <div class="overview-grid">
      <div class="overview-card income">
        <div class="card-icon">üíµ</div>
        <div class="card-content">
          <h3>Revenus</h3>
          <p class="amount positive">{{ monthlySalary | number:'1.2-2' }} ‚Ç¨</p>
        </div>
      </div>
      <div class="overview-card expenses">
        <div class="card-icon">üí∏</div>
        <div class="card-content">
          <h3>D√©penses</h3>
          <p class="amount negative">{{ monthlyExpenses | number:'1.2-2' }} ‚Ç¨</p>
        </div>
      </div>
      <div class="overview-card balance" [class.negative]="remainingBalance < 0">
        <div class="card-icon">{{ remainingBalance >= 0 ? '‚úÖ' : '‚ö†Ô∏è' }}</div>
        <div class="card-content">
          <h3>Reste</h3>
          <p class="amount" [class.positive]="remainingBalance >= 0" [class.negative]="remainingBalance < 0">
            {{ remainingBalance | number:'1.2-2' }} ‚Ç¨
          </p>
        </div>
      </div>
    </div>

    <div class="expenses-by-category">
      <h3>üìä D√©penses par cat√©gorie</h3>
      <div class="category-list">
        <div *ngFor="let category of expenseCategories" class="category-item">
          <div class="category-info">
            <span class="category-icon">{{ getCategoryIcon(category) }}</span>
            <span class="category-name">{{ getCategoryName(category) }}</span>
          </div>
          <span class="category-amount">{{ getExpensesByCategory(category) | number:'1.2-2' }} ‚Ç¨</span>
        </div>
      </div>
    </div>

    <div *ngIf="savingsSuggestions.length > 0" class="suggestions-card">
      <h3>üí° Suggestions d'√©conomies</h3>
      <ul>
        <li *ngFor="let suggestion of savingsSuggestions">{{ suggestion }}</li>
      </ul>
    </div>
  </div>

  <!-- Salary Tab -->
  <div *ngIf="activeTab === 'salary'" class="tab-content">
    <div class="section-header">
      <h2>üíµ Salaires</h2>
      <button type="button" class="btn btn-primary" (click)="showSalaryForm = true">+ Ajouter un salaire</button>
    </div>

    <div class="salaries-list">
      <div *ngFor="let salary of salaries.slice().reverse()" class="salary-card">
        <div class="salary-header">
          <div class="salary-info">
            <h4>{{ salary.description || 'Salaire' }}</h4>
            <span class="salary-period">{{ salary.period === 'monthly' ? 'Mensuel' : 'Annuel' }}</span>
          </div>
          <span class="salary-amount positive">{{ salary.amount | number:'1.2-2' }} ‚Ç¨</span>
        </div>
        <div class="salary-meta">
          <span class="date">{{ salary.date | date:'short' }}</span>
        </div>
        <button class="btn btn-small btn-danger" (click)="deleteSalary(salary.id)">Supprimer</button>
      </div>
      <div *ngIf="salaries.length === 0" class="empty-state">
        <p>Aucun salaire enregistr√©</p>
      </div>
    </div>
  </div>

  <!-- Expenses Tab -->
  <div *ngIf="activeTab === 'expenses'" class="tab-content">
    <div class="section-header">
      <h2>üí∏ D√©penses</h2>
      <button type="button" class="btn btn-primary" (click)="showExpenseForm = true">+ Ajouter une d√©pense</button>
    </div>

    <div class="expenses-list">
      <div *ngFor="let expense of expenses.slice().reverse()" class="expense-card">
        <div class="expense-header">
          <div class="expense-info">
            <span class="expense-icon">{{ getCategoryIcon(expense.category) }}</span>
            <h4>{{ expense.description }}</h4>
          </div>
          <span class="expense-amount negative">{{ expense.amount | number:'1.2-2' }} ‚Ç¨</span>
        </div>
        <div class="expense-meta">
          <span class="category-badge">{{ getCategoryName(expense.category) }}</span>
          <span class="date">{{ expense.date | date:'short' }}</span>
        </div>
        <button class="btn btn-small btn-danger" (click)="deleteExpense(expense.id)">Supprimer</button>
      </div>
      <div *ngIf="expenses.length === 0" class="empty-state">
        <p>Aucune d√©pense enregistr√©e</p>
      </div>
    </div>
  </div>

  <!-- Budget Tab -->
  <div *ngIf="activeTab === 'budget'" class="tab-content">
    <div class="section-header">
      <h2>üìä Budgets</h2>
      <button type="button" class="btn btn-primary" (click)="showBudgetForm = true">+ Nouveau budget</button>
    </div>

    <div class="budgets-list">
      <div *ngFor="let budget of budgets" class="budget-card">
        <div class="budget-header">
          <h4>{{ budget.category }}</h4>
          <span class="budget-period">{{ budget.period === 'monthly' ? 'Mensuel' : budget.period === 'weekly' ? 'Hebdomadaire' : 'Annuel' }}</span>
        </div>
        <div class="budget-progress">
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="getBudgetProgress(budget)" [class.over-budget]="getBudgetProgress(budget) > 100"></div>
          </div>
          <div class="budget-amounts">
            <span>{{ budget.spent | number:'1.2-2' }} ‚Ç¨ / {{ budget.limit | number:'1.2-2' }} ‚Ç¨</span>
            <span class="percentage" [class.over-budget]="getBudgetProgress(budget) > 100">{{ getBudgetProgress(budget) | number:'1.0-0' }}%</span>
          </div>
        </div>
        <button class="btn btn-small btn-danger" (click)="deleteBudget(budget.id)">Supprimer</button>
      </div>
      <div *ngIf="budgets.length === 0" class="empty-state">
        <p>Aucun budget d√©fini</p>
      </div>
    </div>
  </div>

  <!-- Savings Tab -->
  <div *ngIf="activeTab === 'savings'" class="tab-content">
    <div class="section-header">
      <h2>üéØ Objectifs d'√©pargne</h2>
      <button type="button" class="btn btn-primary" (click)="showSavingsForm = true">+ Nouvel objectif</button>
    </div>

    <div class="savings-goals-list">
      <div *ngFor="let goal of savingsGoals" class="savings-card">
        <div class="savings-header">
          <h4>{{ goal.name }}</h4>
          <span *ngIf="goal.deadline" class="deadline">{{ goal.deadline | date:'shortDate' }}</span>
        </div>
        <div class="savings-progress">
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="getSavingsProgress(goal)"></div>
          </div>
          <div class="savings-amounts">
            <span>{{ goal.currentAmount | number:'1.2-2' }} ‚Ç¨ / {{ goal.targetAmount | number:'1.2-2' }} ‚Ç¨</span>
            <span class="percentage">{{ getSavingsProgress(goal) | number:'1.0-0' }}%</span>
          </div>
        </div>
        <div class="savings-actions">
          <input type="number" step="0.01" [value]="goal.currentAmount" 
                 (change)="updateSavingsGoal(goal.id, +$any($event.target).value)" 
                 placeholder="Mettre √† jour">
          <button class="btn btn-small btn-danger" (click)="deleteSavingsGoal(goal.id)">Supprimer</button>
        </div>
      </div>
      <div *ngIf="savingsGoals.length === 0" class="empty-state">
        <p>Aucun objectif d'√©pargne d√©fini</p>
      </div>
    </div>
  </div>

  <!-- Salary Modal -->
  <app-modal *ngIf="showSalaryForm" title="Nouveau salaire" size="sm" (closeModal)="closeSalaryModal()">
    <form (ngSubmit)="addSalary()">
      <div class="form-group">
        <label>Montant (‚Ç¨) *</label>
        <input type="number" step="0.01" [(ngModel)]="newSalary.amount" name="amount" required>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>P√©riode *</label>
          <select [(ngModel)]="newSalary.period" name="period" required>
            <option value="monthly">Mensuel</option>
            <option value="yearly">Annuel</option>
          </select>
        </div>
        <div class="form-group">
          <label>Date</label>
          <input type="date" [(ngModel)]="newSalary.date" name="date">
        </div>
      </div>
      <div class="form-group">
        <label>Description</label>
        <input type="text" [(ngModel)]="newSalary.description" name="description" placeholder="Ex: Salaire principal">
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="closeSalaryModal()">Annuler</button>
        <button type="submit" class="btn btn-primary">Ajouter</button>
      </div>
    </form>
  </app-modal>

  <!-- Expense Modal -->
  <app-modal *ngIf="showExpenseForm" title="Nouvelle d√©pense" size="md" (closeModal)="closeExpenseModal()">
    <form (ngSubmit)="addExpense()">
      <div class="form-group">
        <label>Description *</label>
        <input type="text" [(ngModel)]="newExpense.description" name="description" required>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Montant (‚Ç¨) *</label>
          <input type="number" step="0.01" [(ngModel)]="newExpense.amount" name="amount" required>
        </div>
        <div class="form-group">
          <label>Cat√©gorie</label>
          <select [(ngModel)]="newExpense.category" name="category">
            <option *ngFor="let cat of expenseCategories" [value]="cat">{{ getCategoryName(cat) }}</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label>Moyen de paiement</label>
        <input type="text" [(ngModel)]="newExpense.paymentMethod" name="paymentMethod" placeholder="Ex: Carte bancaire">
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="closeExpenseModal()">Annuler</button>
        <button type="submit" class="btn btn-primary">Ajouter</button>
      </div>
    </form>
  </app-modal>

  <!-- Budget Modal -->
  <app-modal *ngIf="showBudgetForm" title="Nouveau budget" size="sm" (closeModal)="closeBudgetModal()">
    <form (ngSubmit)="addBudget()">
      <div class="form-group">
        <label>Cat√©gorie *</label>
        <input type="text" [(ngModel)]="newBudget.category" name="category" required>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Limite (‚Ç¨) *</label>
          <input type="number" step="0.01" [(ngModel)]="newBudget.limit" name="limit" required>
        </div>
        <div class="form-group">
          <label>P√©riode</label>
          <select [(ngModel)]="newBudget.period" name="period">
            <option value="weekly">Hebdomadaire</option>
            <option value="monthly">Mensuel</option>
            <option value="yearly">Annuel</option>
          </select>
        </div>
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="closeBudgetModal()">Annuler</button>
        <button type="submit" class="btn btn-primary">Cr√©er</button>
      </div>
    </form>
  </app-modal>

  <!-- Savings Goal Modal -->
  <app-modal *ngIf="showSavingsForm" title="Nouvel objectif d'√©pargne" size="sm" (closeModal)="closeSavingsModal()">
    <form (ngSubmit)="addSavingsGoal()">
      <div class="form-group">
        <label>Nom *</label>
        <input type="text" [(ngModel)]="newSavingsGoal.name" name="name" required>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Montant cible (‚Ç¨) *</label>
          <input type="number" step="0.01" [(ngModel)]="newSavingsGoal.targetAmount" name="targetAmount" required>
        </div>
        <div class="form-group">
          <label>Montant actuel (‚Ç¨)</label>
          <input type="number" step="0.01" [(ngModel)]="newSavingsGoal.currentAmount" name="currentAmount">
        </div>
      </div>
      <div class="form-group">
        <label>Date limite</label>
        <input type="date" [(ngModel)]="newSavingsGoal.deadline" name="deadline">
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="closeSavingsModal()">Annuler</button>
        <button type="submit" class="btn btn-primary">Cr√©er</button>
      </div>
    </form>
  </app-modal>
</div>
