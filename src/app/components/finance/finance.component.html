<div class="finance-page">
  <header class="finance-header">
    <div class="finance-header-inner">
      <span class="finance-header-icon" aria-hidden="true">ğŸ’°</span>
      <h1>{{ 'finance.title' | translate }}</h1>
      <p class="finance-header-sub">{{ 'finance.subtitle' | translate }}</p>
    </div>
  </header>

  <div class="month-selector-bar">
    <div class="month-selector-center">
      <button type="button" class="month-btn month-prev" (click)="goToPrevMonth()" [attr.aria-label]="'common.previous' | translate">â€¹</button>
      <span class="month-label">{{ selectedMonthLabel }}</span>
      <button type="button" class="month-btn month-next" (click)="goToNextMonth()" [disabled]="!canGoToNextMonth" [attr.aria-label]="'common.next' | translate">â€º</button>
    </div>
    <button type="button" class="btn btn-secondary btn-today" (click)="goToCurrentMonth()">{{ 'finance.thisMonth' | translate }}</button>
  </div>

  <nav class="finance-tabs" role="tablist" aria-label="Finance sections">
    <button type="button" role="tab" [attr.aria-selected]="activeTab === 'overview'" [class.active]="activeTab === 'overview'" [disabled]="tabsDisabled" [attr.aria-disabled]="tabsDisabled" (click)="activeTab = 'overview'">
      <span class="tab-icon">ğŸ“Š</span>{{ 'finance.overview' | translate }}
    </button>
    <button type="button" role="tab" [attr.aria-selected]="activeTab === 'salary'" [class.active]="activeTab === 'salary'" [disabled]="tabsDisabled" [attr.aria-disabled]="tabsDisabled" (click)="activeTab = 'salary'">
      <span class="tab-icon">ğŸ’µ</span>{{ 'finance.salary' | translate }}
    </button>
    <button type="button" role="tab" [attr.aria-selected]="activeTab === 'expenses'" [class.active]="activeTab === 'expenses'" [disabled]="tabsDisabled" [attr.aria-disabled]="tabsDisabled" (click)="activeTab = 'expenses'">
      <span class="tab-icon">ğŸ’¸</span>{{ 'finance.expenses' | translate }}
    </button>
    <button type="button" role="tab" [attr.aria-selected]="activeTab === 'budget'" [class.active]="activeTab === 'budget'" [disabled]="tabsDisabled" [attr.aria-disabled]="tabsDisabled" (click)="activeTab = 'budget'">
      <span class="tab-icon">ğŸ“‹</span>{{ 'finance.budget' | translate }}
    </button>
    <button type="button" role="tab" [attr.aria-selected]="activeTab === 'savings'" [class.active]="activeTab === 'savings'" [disabled]="tabsDisabled" [attr.aria-disabled]="tabsDisabled" (click)="activeTab = 'savings'">
      <span class="tab-icon">ğŸ¯</span>{{ 'finance.savings' | translate }}
    </button>
  </nav>

  <!-- Overview Tab -->
  <div *ngIf="activeTab === 'overview'" class="tab-content tab-content-animate" role="tabpanel">
    <p class="month-context">{{ 'finance.forMonth' | translate }} {{ selectedMonthLabel }}</p>
    <!-- Bank Card (from wallet or fallback) â€“ each card has its own balance and expenses (affichÃ© aprÃ¨s le loader) -->
    <div class="bank-card-wrapper" *ngIf="walletCardsLoaded && walletCards.length >= 1">
      <p class="finance-card-context" *ngIf="selectedCard">{{ 'finance.statsForThisCard' | translate }}</p>
      <!-- Stack comme sur lâ€™image : carte devant + bandeaux derriÃ¨re. Clic sur la carte = les bandeaux sâ€™ouvrent un peu pour afficher les autres infos. -->
      <div class="wallet-stack" [class.wallet-stack-opened]="showCardList" *ngIf="walletCards.length > 1" role="tablist" [attr.aria-label]="'finance.selectCardToView' | translate">
        <div class="wallet-stack-peeks" [class.wallet-stack-peeks-opened]="showCardList">
          <ng-container *ngFor="let card of peekCardsOrdered">
            <div (click)="selectCard(card)" class="wallet-peek" [style.background]="getCardGradient(card)" tabindex="0" role="tab">
              <span class="wallet-peek-name">{{ card.name || card.holderName }}</span>
              <span class="wallet-peek-last4">â€¢â€¢â€¢â€¢ {{ (card.cardNumber | slice:-4) }}</span>
            </div>
          </ng-container>
        </div>
        <div class="bank-card bank-card-front bank-card-front-tappable"
             appSwipePreventScroll
             (click)="toggleCardList()"
             (keydown.enter)="toggleCardList()"
             (keydown.space)="toggleCardList()"
             (touchstart)="onCardSwipeStart($event)"
             (touchmove)="onCardSwipeMove($event)"
             (touchend)="onCardSwipeEnd()"
             (mousedown)="onCardSwipeStart($event)"
             (mouseup)="onCardSwipeEnd()"
             (transitionend)="onCardSwipeTransitionEnd($event)"
             [class.card-swipe-dragging]="isSwiping"
             [class.card-swipe-animating]="isCardSwipeAnimating"
             [class.card-transitioning]="cardTransitioning"
             [class.negative-balance]="remainingBalance < 0"
             [style.background]="getFrontCardGradient()"
             [style.transform]="cardSwipeTransform || null"
             tabindex="0"
             role="button"
             [attr.aria-label]="'finance.viewAllCards' | translate">
          <div class="card-chip"></div>
          <div class="card-header-row">
            <div class="card-logo">{{ displayCardName }}</div>
            <div class="card-currency-badge" *ngIf="displayCardCurrency">{{ displayCardCurrencyLabel | translate }}</div>
          </div>
          <div class="card-number">{{ displayCardNumber }}</div>
          <div class="card-details">
            <div class="card-expiry-section">
              <div class="card-label">{{ 'finance.expires' | translate }}</div>
              <div class="card-expiry">{{ displayExpiry }}</div>
            </div>
          </div>
          <div class="card-balance">
            <div class="balance-label">{{ 'finance.availableBalance' | translate }}</div>
            <div class="balance-amount animate-number" [class.negative]="remainingBalance < 0">
              <app-count-up [value]="remainingBalance" format="1.2-2" [suffix]="' ' + currencySymbol" [duration]="800"></app-count-up>
            </div>
          </div>
          <span class="card-brand" aria-hidden="true">VISA</span>
          <span class="bank-card-front-hint">{{ 'finance.tapToChangeCard' | translate }}</span>
        </div>
      </div>
    </div>
    <div class="bank-card" [class.negative-balance]="remainingBalance < 0" [style.background]="getFrontCardGradient()" *ngIf="walletCardsLoaded && walletCards.length === 1">
      <div class="card-chip"></div>
      <div class="card-header-row">
        <div class="card-logo">{{ displayCardName }}</div>
        <div class="card-currency-badge" *ngIf="displayCardCurrency">{{ displayCardCurrencyLabel | translate }}</div>
      </div>
      <div class="card-number">{{ displayCardNumber }}</div>
      <div class="card-details">
        <div class="card-expiry-section">
          <div class="card-label">{{ 'finance.expires' | translate }}</div>
          <div class="card-expiry">{{ displayExpiry }}</div>
        </div>
      </div>
      <div class="card-balance">
        <div class="balance-label">{{ 'finance.availableBalance' | translate }}</div>
        <div class="balance-amount animate-number" [class.negative]="remainingBalance < 0">
          <app-count-up [value]="remainingBalance" format="1.2-2" [suffix]="' ' + currencySymbol" [duration]="800"></app-count-up>
        </div>
      </div>
      <span class="card-brand" aria-hidden="true">VISA</span>
    </div>
    <div *ngIf="!walletCardsLoaded" class="finance-cards-loading" aria-busy="true">
      <div class="finance-cards-loading-placeholder"></div>
    </div>
    <div *ngIf="walletCardsLoaded && walletCards.length === 0" class="finance-no-cards">
      <div class="finance-no-cards-icon" aria-hidden="true">ğŸ’³</div>
      <h2 class="finance-no-cards-title">{{ 'finance.noCardsTitle' | translate }}</h2>
      <p class="finance-no-cards-desc">{{ 'finance.noCardsDesc' | translate }}</p>
      <a routerLink="/settings" class="finance-no-cards-btn" role="button">{{ 'finance.goToWallet' | translate }}</a>
    </div>

    <p *ngIf="selectedCard" class="overview-context-card">{{ 'finance.statsForThisCard' | translate }}</p>
    <div class="overview-grid">
      <div class="overview-card income">
        <div class="card-icon">ğŸ’µ</div>
        <div class="card-content">
          <h3>{{ 'finance.income' | translate }}</h3>
          <p class="amount positive animate-number animate-number-delay-1"><app-count-up [value]="monthlySalary" format="1.2-2" [suffix]="' ' + currencySymbol" [duration]="600"></app-count-up></p>
        </div>
      </div>
      <div class="overview-card expenses">
        <div class="card-icon">ğŸ’¸</div>
        <div class="card-content">
          <h3>{{ 'finance.expenses' | translate }}</h3>
          <p class="amount negative animate-number animate-number-delay-2"><app-count-up [value]="monthlyExpenses" format="1.2-2" [suffix]="' ' + currencySymbol" [duration]="600"></app-count-up></p>
        </div>
      </div>
      <div class="overview-card balance" [class.negative]="remainingBalance < 0">
        <div class="card-icon">{{ remainingBalance >= 0 ? 'âœ…' : 'âš ï¸' }}</div>
        <div class="card-content">
          <h3>{{ 'finance.remaining' | translate }}</h3>
          <p class="amount animate-number animate-number-delay-3" [class.positive]="remainingBalance >= 0" [class.negative]="remainingBalance < 0">
            <app-count-up [value]="remainingBalance" format="1.2-2" [suffix]="' ' + currencySymbol" [duration]="600"></app-count-up>
          </p>
        </div>
      </div>
    </div>

    <div class="expenses-by-category dropdown-section category-tlp-format">
      <div class="category-section-header">
        <button type="button" class="category-section-toggle category-tlp-toggle" (click)="expensesByCategoryExpanded = !expensesByCategoryExpanded" [attr.aria-expanded]="expensesByCategoryExpanded" [attr.aria-controls]="'category-content'" [attr.aria-label]="'finance.expensesByCategory' | translate">
          <span class="category-tlp-icon" aria-hidden="true">ğŸ“Š</span>
          <span class="category-tlp-title">{{ 'finance.expensesByCategory' | translate }}</span>
          <span class="category-tlp-chevron" [class.category-tlp-chevron-open]="expensesByCategoryExpanded" aria-hidden="true"></span>
        </button>
      </div>
      <div class="category-month-row category-tlp-bar" (click)="$event.stopPropagation()">
        <div class="category-month-center">
          <button type="button" class="category-month-btn month-prev" (click)="goToPrevMonth()" [attr.aria-label]="'common.previous' | translate" title="{{ 'common.previous' | translate }}">â€¹</button>
          <span class="category-month-label">{{ selectedMonthLabel }}</span>
          <button type="button" class="category-month-btn month-next" (click)="goToNextMonth()" [disabled]="!canGoToNextMonth" [attr.aria-label]="'common.next' | translate" title="{{ 'common.next' | translate }}">â€º</button>
        </div>
        <button type="button" class="category-btn-current" (click)="goToCurrentMonth()">{{ 'finance.thisMonth' | translate }}</button>
      </div>
      <div id="category-content" class="category-dropdown-content" [class.is-open]="expensesByCategoryExpanded" [attr.aria-hidden]="!expensesByCategoryExpanded">
        <div *ngFor="let category of expenseCategoriesForOverviewNonZero" class="category-item category-item-with-bar">
          <div class="category-item-row">
            <span class="category-name">{{ getCategoryName(category) }}</span>
            <span class="category-amount">{{ getExpensesByCategory(category) | number:'1.2-2' }} {{ currencySymbol }}</span>
            <span class="category-percent">{{ getExpenseCategoryPercent(category) | number:'1.0-0' }}%</span>
          </div>
          <div class="category-progress-bar">
            <div class="category-progress-fill" [style.width.%]="progressReady ? getExpenseCategoryPercent(category) : 0" role="progressbar" [attr.aria-valuenow]="getExpenseCategoryPercent(category)" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="savingsSuggestions.length > 0" class="suggestions-card">
      <h3><span class="suggestion-emoji">ğŸ’¡</span> {{ 'finance.savingsSuggestions' | translate }}</h3>
      <ul>
        <li *ngFor="let suggestion of savingsSuggestions">{{ suggestion }}</li>
      </ul>
    </div>
  </div>

  <!-- Salary Tab -->
  <div *ngIf="activeTab === 'salary'" class="tab-content tab-content-animate" role="tabpanel">
    <p class="month-context">{{ 'finance.forMonth' | translate }} {{ selectedMonthLabel }}</p>
    <div class="section-header">
      <h2>{{ 'finance.salariesTitle' | translate }}</h2>
      <button type="button" class="btn btn-primary btn-add" (click)="openSalaryForm()">+ {{ 'finance.addSalary' | translate }}</button>
    </div>

    <div class="finance-list salaries-list">
      <div *ngFor="let salary of salariesForMonth.slice().reverse()" class="finance-card salary-card finance-card-salary">
        <div class="finance-card-accent"></div>
        <div class="finance-card-body">
          <div class="finance-card-top">
            <span class="finance-card-icon">ğŸ’µ</span>
            <div class="finance-card-main">
              <h4>{{ salary.description || ('finance.salaryLabel' | translate) }}</h4>
              <span class="finance-meta">{{ salary.period === 'monthly' ? ('common.monthly' | translate) : ('common.yearly' | translate) }}</span>
            </div>
            <span class="finance-amount positive">{{ salary.amount | number:'1.2-2' }} {{ currencySymbol }}</span>
            <button type="button" class="btn-icon btn-icon-danger" (click)="deleteSalary(salary.id)" [attr.aria-label]="'common.delete' | translate">Ã—</button>
          </div>
          <small class="finance-date">{{ salary.date | date:'short' }}</small>
        </div>
      </div>
      <app-empty-state 
        *ngIf="salariesForMonth.length === 0"
        icon="ğŸ’µ"
        [title]="'finance.noSalary' | translate"
        [message]="'finance.noSalaryMessage' | translate"
        [actionText]="'+ ' + ('finance.addSalary' | translate)"
        (action)="openSalaryForm()">
      </app-empty-state>
    </div>
  </div>

  <!-- Expenses Tab -->
  <div *ngIf="activeTab === 'expenses'" class="tab-content tab-content-animate" role="tabpanel">
    <p class="month-context">{{ 'finance.forMonth' | translate }} {{ selectedMonthLabel }}</p>
    <div class="section-header">
      <h2>{{ 'finance.expenses' | translate }}</h2>
      <button type="button" class="btn btn-primary btn-add" (click)="openExpenseForm()">+ {{ 'finance.addExpense' | translate }}</button>
    </div>

    <div class="expenses-by-category-list" *ngIf="getExpensesGroupedByCategory().length > 0">
      <div *ngFor="let group of getExpensesGroupedByCategory()" class="expense-category-group">
        <button type="button" class="expense-category-group-toggle" (click)="toggleExpenseCategory(group.category)" [attr.aria-expanded]="isExpenseCategoryExpanded(group.category)">
          <span class="group-toggle-icon" aria-hidden="true">{{ isExpenseCategoryExpanded(group.category) ? 'â–¼' : 'â–¶' }}</span>
          <span class="group-toggle-icon-emoji">{{ getCategoryIcon(group.category) }}</span>
          <span class="group-toggle-title">{{ group.categoryName }}</span>
          <span class="group-toggle-meta">{{ group.expenses.length }} {{ 'finance.expenses' | translate }}</span>
          <span class="group-toggle-total">{{ group.total | number:'1.2-2' }} {{ currencySymbol }}</span>
        </button>
        <div class="expense-category-group-content" *ngIf="isExpenseCategoryExpanded(group.category)">
          <div *ngFor="let expense of group.expenses" class="finance-card expense-card finance-card-expense">
            <div class="finance-card-accent"></div>
            <div class="finance-card-body">
              <div class="finance-card-top">
                <span class="finance-card-icon">{{ getCategoryIcon(expense.category) }}</span>
                <div class="finance-card-main">
                  <h4>{{ expense.description }}</h4>
                  <small class="finance-date">{{ expense.date | date:'short' }}</small>
                </div>
                <span class="finance-amount negative">{{ expense.amount | number:'1.2-2' }} {{ currencySymbol }}</span>
                <button type="button" class="btn-icon btn-icon-danger" (click)="deleteExpense(expense.id)" [attr.aria-label]="'common.delete' | translate">Ã—</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <app-empty-state 
      *ngIf="expensesForMonth.length === 0"
      icon="ğŸ’¸"
      [title]="'finance.noExpense' | translate"
      [message]="'finance.noExpenseMessage' | translate"
      [actionText]="'+ ' + ('finance.addExpense' | translate)"
      (action)="openExpenseForm()">
    </app-empty-state>
  </div>

  <!-- Budget Tab -->
  <div *ngIf="activeTab === 'budget'" class="tab-content tab-content-animate" role="tabpanel">
    <div class="section-header">
      <h2>{{ 'finance.budget' | translate }}</h2>
      <button type="button" class="btn btn-primary btn-add" (click)="showBudgetForm = true">+ {{ 'finance.newBudget' | translate }}</button>
    </div>

    <div class="finance-list budgets-list">
      <div *ngFor="let budget of budgets" class="finance-card budget-card finance-card-budget">
        <div class="finance-card-accent"></div>
        <div class="finance-card-body">
          <div class="finance-card-top">
            <span class="finance-card-icon">ğŸ“‹</span>
            <div class="finance-card-main">
              <h4>{{ getCategoryName(budget.category) | translate }}</h4>
              <span class="finance-meta">{{ budget.period === 'monthly' ? ('common.monthly' | translate) : budget.period === 'weekly' ? ('common.weekly' | translate) : ('common.yearly' | translate) }}</span>
            </div>
            <button type="button" class="btn-icon btn-icon-danger" (click)="deleteBudget(budget.id)" [attr.aria-label]="'common.delete' | translate">Ã—</button>
          </div>
          <div class="budget-progress">
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="progressReady ? getBudgetProgress(budget) : 0" [class.over-budget]="getBudgetProgress(budget) > 100"></div>
            </div>
            <div class="budget-amounts">
              <span>{{ budget.spent | number:'1.2-2' }} {{ currencySymbol }} / {{ budget.limit | number:'1.2-2' }} {{ currencySymbol }}</span>
              <span class="percentage" [class.over-budget]="getBudgetProgress(budget) > 100"><app-count-up [value]="getBudgetProgress(budget)" format="1.0-0" suffix="%" [duration]="500"></app-count-up></span>
            </div>
          </div>
        </div>
      </div>
      <app-empty-state 
        *ngIf="budgets.length === 0"
        icon="ğŸ“Š"
        [title]="'finance.noBudgetEmptyTitle' | translate"
        [message]="'finance.noBudgetEmptyMessage' | translate"
        [actionText]="'+ ' + ('finance.newBudget' | translate)"
        (action)="showBudgetForm = true">
      </app-empty-state>
    </div>
  </div>

  <!-- Savings Tab -->
  <div *ngIf="activeTab === 'savings'" class="tab-content tab-content-animate" role="tabpanel">
    <div class="section-header">
      <h2>{{ 'finance.savingsGoalsTitle' | translate }}</h2>
      <button type="button" class="btn btn-primary btn-add" (click)="showSavingsForm = true">+ {{ 'finance.newSavingsGoal' | translate }}</button>
    </div>

    <div class="finance-list savings-goals-list">
      <div *ngFor="let goal of savingsGoals" class="finance-card savings-card finance-card-savings">
        <div class="finance-card-accent"></div>
        <div class="finance-card-body">
          <div class="finance-card-top">
            <span class="finance-card-icon">ğŸ¯</span>
            <div class="finance-card-main">
              <h4>{{ goal.name }}</h4>
              <span *ngIf="goal.deadline" class="finance-meta deadline">{{ goal.deadline | date:'shortDate' }}</span>
            </div>
            <button type="button" class="btn-icon btn-icon-danger" (click)="deleteSavingsGoal(goal.id)" [attr.aria-label]="'common.delete' | translate">Ã—</button>
          </div>
          <div class="savings-progress">
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="progressReady ? getSavingsProgress(goal) : 0"></div>
            </div>
            <div class="savings-amounts">
              <span>{{ goal.currentAmount | number:'1.2-2' }} {{ currencySymbol }} / {{ goal.targetAmount | number:'1.2-2' }} {{ currencySymbol }}</span>
              <span class="percentage"><app-count-up [value]="getSavingsProgress(goal)" format="1.0-0" suffix="%" [duration]="500"></app-count-up></span>
            </div>
          </div>
          <div class="savings-actions">
            <button type="button" class="btn btn-small btn-primary" (click)="openSavingsAdjust(goal, 'add')">+ {{ 'finance.addAmount' | translate }}</button>
            <button type="button" class="btn btn-small btn-secondary" (click)="openSavingsAdjust(goal, 'decrease')">âˆ’ {{ 'finance.decreaseAmount' | translate }}</button>
          </div>
        </div>
      </div>
      <app-empty-state 
        *ngIf="savingsGoals.length === 0"
        icon="ğŸ¯"
        [title]="'finance.noSavingsGoal' | translate"
        [message]="'finance.noSavingsMessage' | translate"
        [actionText]="'+ ' + ('finance.newSavingsGoal' | translate)"
        (action)="showSavingsForm = true">
      </app-empty-state>
    </div>
  </div>

  <!-- Salary Modal -->
  <app-modal *ngIf="showSalaryForm" [title]="'finance.newSalary' | translate" size="sm" (closeModal)="closeSalaryModal()">
    <form #salaryForm="ngForm" (ngSubmit)="addSalary()">
      <div class="form-group">
        <label for="salary-amount">{{ 'common.amount' | translate }} ({{ currencySymbol }}) *</label>
        <input id="salary-amount" type="number" step="0.01" [(ngModel)]="newSalary.amount" name="amount" #salaryAmount="ngModel" required aria-required="true">
        <span class="field-error" *ngIf="salaryAmount.invalid && (salaryAmount.touched || salaryForm.submitted)">{{ 'validation.required' | translate }}</span>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="salary-period">{{ 'common.period' | translate }} *</label>
          <select id="salary-period" [(ngModel)]="newSalary.period" name="period" #salaryPeriod="ngModel" required aria-required="true">
            <option value="monthly">{{ 'common.monthly' | translate }}</option>
            <option value="yearly">{{ 'common.yearly' | translate }}</option>
          </select>
          <span class="field-error" *ngIf="salaryPeriod.invalid && (salaryPeriod.touched || salaryForm.submitted)">{{ 'validation.required' | translate }}</span>
        </div>
        <div class="form-group">
          <label for="salary-date">{{ 'finance.dateLabel' | translate }}</label>
          <input id="salary-date" type="date" [(ngModel)]="newSalary.date" name="date" #salaryDate="ngModel">
          <span class="field-error" *ngIf="salaryDate.invalid && (salaryDate.touched || salaryForm.submitted)">{{ 'validation.required' | translate }}</span>
        </div>
      </div>
      <div class="form-group">
        <label for="salary-description">{{ 'common.description' | translate }}</label>
        <input id="salary-description" type="text" [(ngModel)]="newSalary.description" name="description" #salaryDescription="ngModel" [placeholder]="'finance.salaryDescPlaceholder' | translate">
        <span class="field-error" *ngIf="salaryDescription.invalid && (salaryDescription.touched || salaryForm.submitted)">{{ 'validation.required' | translate }}</span>
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="closeSalaryModal()">{{ 'common.cancel' | translate }}</button>
        <button type="submit" class="btn btn-primary">{{ 'common.add' | translate }}</button>
      </div>
    </form>
  </app-modal>

  <!-- Expense Modal -->
  <app-modal *ngIf="showExpenseForm" [title]="'finance.newExpenseTitle' | translate" size="md" (closeModal)="closeExpenseModal()">
    <form #expenseForm="ngForm" (ngSubmit)="addExpense()">
      <div class="form-group">
        <label for="expense-description">{{ 'finance.descriptionLabel' | translate }} *</label>
        <input id="expense-description" type="text" [(ngModel)]="newExpense.description" name="description" #expenseDesc="ngModel" required aria-required="true">
        <span class="field-error" *ngIf="expenseDesc.invalid && (expenseDesc.touched || expenseForm.submitted)">{{ 'validation.required' | translate }}</span>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="expense-amount">{{ 'common.amount' | translate }} ({{ currencySymbol }}) *</label>
          <input id="expense-amount" type="number" step="0.01" [(ngModel)]="newExpense.amount" name="amount" #expenseAmount="ngModel" required aria-required="true">
          <span class="field-error" *ngIf="expenseAmount.invalid && (expenseAmount.touched || expenseForm.submitted)">{{ 'validation.required' | translate }}</span>
        </div>
        <div class="form-group category-group">
          <label for="expense-category">{{ 'common.category' | translate }}</label>
          <select id="expense-category" [(ngModel)]="newExpense.category" name="category" #expenseCategory="ngModel">
            <option *ngFor="let cat of expenseCategories" [value]="cat">{{ getCategoryName(cat) }}</option>
            <option [value]="addCategoryValue">+ {{ 'finance.addCategory' | translate }}</option>
          </select>
          <div *ngIf="newExpense.category === addCategoryValue" class="add-category-row">
            <input type="text" [(ngModel)]="newCategoryName" name="newCategoryName" [placeholder]="'finance.newCategoryPlaceholder' | translate" (keydown.enter)="$event.preventDefault(); addCustomCategory()">
            <button type="button" class="btn btn-secondary btn-add-cat" (click)="addCustomCategory()" [disabled]="!newCategoryName.trim()">{{ 'finance.addCategoryButton' | translate }}</button>
          </div>
          <span class="field-error" *ngIf="expenseCategory.invalid && (expenseCategory.touched || expenseForm.submitted)">{{ 'validation.required' | translate }}</span>
        </div>
      </div>
      <div class="form-group">
        <label>{{ 'finance.dateLabel' | translate }}</label>
        <input type="date" [(ngModel)]="newExpense.date" name="date" #expenseDate="ngModel">
        <span class="field-error" *ngIf="expenseDate.invalid && (expenseDate.touched || expenseForm.submitted)">{{ 'validation.required' | translate }}</span>
      </div>
      <div class="form-group">
        <label>{{ 'finance.paymentMethod' | translate }}</label>
        <input type="text" [(ngModel)]="newExpense.paymentMethod" name="paymentMethod" #expensePayment="ngModel" [placeholder]="'finance.paymentPlaceholder' | translate">
        <span class="field-error" *ngIf="expensePayment.invalid && (expensePayment.touched || expenseForm.submitted)">{{ 'validation.required' | translate }}</span>
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="closeExpenseModal()">{{ 'common.cancel' | translate }}</button>
        <button type="submit" class="btn btn-primary">{{ 'common.add' | translate }}</button>
      </div>
    </form>
  </app-modal>

  <!-- Budget Modal -->
  <app-modal *ngIf="showBudgetForm" [title]="'finance.newBudgetTitle' | translate" size="sm" (closeModal)="closeBudgetModal()">
    <form #budgetForm="ngForm" (ngSubmit)="addBudget()">
      <div class="form-group">
        <label>{{ 'common.category' | translate }} *</label>
        <input type="text" [(ngModel)]="newBudget.category" name="category" #budgetCategory="ngModel" required>
        <span class="field-error" *ngIf="budgetCategory.invalid && (budgetCategory.touched || budgetForm.submitted)">{{ 'validation.required' | translate }}</span>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>{{ 'common.amount' | translate }} ({{ currencySymbol }}) *</label>
          <input type="number" step="0.01" [(ngModel)]="newBudget.limit" name="limit" #budgetLimit="ngModel" required>
          <span class="field-error" *ngIf="budgetLimit.invalid && (budgetLimit.touched || budgetForm.submitted)">{{ 'validation.required' | translate }}</span>
        </div>
        <div class="form-group">
          <label>{{ 'common.period' | translate }}</label>
          <select [(ngModel)]="newBudget.period" name="period" #budgetPeriod="ngModel">
            <option value="weekly">{{ 'common.weekly' | translate }}</option>
            <option value="monthly">{{ 'common.monthly' | translate }}</option>
            <option value="yearly">{{ 'common.yearly' | translate }}</option>
          </select>
          <span class="field-error" *ngIf="budgetPeriod.invalid && (budgetPeriod.touched || budgetForm.submitted)">{{ 'validation.required' | translate }}</span>
        </div>
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="closeBudgetModal()">{{ 'common.cancel' | translate }}</button>
        <button type="submit" class="btn btn-primary">{{ 'common.create' | translate }}</button>
      </div>
    </form>
  </app-modal>

  <!-- Savings Goal Modal -->
  <app-modal *ngIf="showSavingsForm" [title]="'finance.newSavingsGoalTitle' | translate" size="sm" (closeModal)="closeSavingsModal()">
    <form #savingsForm="ngForm" (ngSubmit)="addSavingsGoal()">
      <div class="form-group">
        <label>{{ 'common.name' | translate }} *</label>
        <input type="text" [(ngModel)]="newSavingsGoal.name" name="name" #savingsName="ngModel" required>
        <span class="field-error" *ngIf="savingsName.invalid && (savingsName.touched || savingsForm.submitted)">{{ 'validation.required' | translate }}</span>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>{{ 'finance.targetAmount' | translate }} ({{ currencySymbol }}) *</label>
          <input type="number" step="0.01" [(ngModel)]="newSavingsGoal.targetAmount" name="targetAmount" #savingsTarget="ngModel" required>
          <span class="field-error" *ngIf="savingsTarget.invalid && (savingsTarget.touched || savingsForm.submitted)">{{ 'validation.required' | translate }}</span>
        </div>
        <div class="form-group">
          <label>{{ 'finance.currentAmount' | translate }} ({{ currencySymbol }})</label>
          <input type="number" step="0.01" [(ngModel)]="newSavingsGoal.currentAmount" name="currentAmount" #savingsCurrent="ngModel">
          <span class="field-error" *ngIf="savingsCurrent.invalid && (savingsCurrent.touched || savingsForm.submitted)">{{ 'validation.required' | translate }}</span>
        </div>
      </div>
      <div class="form-group">
        <label>{{ 'finance.deadline' | translate }}</label>
        <input type="date" [(ngModel)]="newSavingsGoal.deadline" name="deadline" #savingsDeadline="ngModel">
        <span class="field-error" *ngIf="savingsDeadline.invalid && (savingsDeadline.touched || savingsForm.submitted)">{{ 'validation.required' | translate }}</span>
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="closeSavingsModal()">{{ 'common.cancel' | translate }}</button>
        <button type="submit" class="btn btn-primary">{{ 'common.create' | translate }}</button>
      </div>
    </form>
  </app-modal>

  <!-- Modal Ajouter / Retirer montant Ã©pargne -->
  <app-modal *ngIf="showSavingsAdjustModal && savingsAdjustGoal" [title]="savingsAdjustModalTitle" size="sm" (closeModal)="closeSavingsAdjustModal()">
    <form #savingsAdjustForm="ngForm" (ngSubmit)="submitSavingsAdjust()">
      <div class="form-group">
        <label>{{ (savingsAdjustOperation === 'add' ? 'finance.amountToAdd' : 'finance.amountToDecrease') | translate }} ({{ currencySymbol }}) *</label>
        <input type="number" step="0.01" min="0" [(ngModel)]="savingsAdjustAmount" name="savingsAdjustAmount" #savingsAdjustAmountField="ngModel" required>
        <span class="field-error" *ngIf="savingsAdjustAmountField.invalid && (savingsAdjustAmountField.touched || savingsAdjustForm.submitted)">{{ 'validation.required' | translate }}</span>
      </div>
      <p class="savings-adjust-hint" *ngIf="savingsAdjustGoal">
        {{ 'finance.currentAmount' | translate }}: {{ savingsAdjustGoal.currentAmount | number:'1.2-2' }} {{ currencySymbol }}
      </p>
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="closeSavingsAdjustModal()">{{ 'common.cancel' | translate }}</button>
        <button type="submit" class="btn btn-primary" [disabled]="savingsAdjustAmount <= 0">{{ 'common.save' | translate }}</button>
      </div>
    </form>
  </app-modal>

  <!-- Confirm Dialogs -->
  <app-confirm-dialog
    [isOpen]="showDeleteExpenseConfirm"
    title="Supprimer la dÃ©pense"
    message="ÃŠtes-vous sÃ»r de vouloir supprimer cette dÃ©pense ? Cette action est irrÃ©versible."
    confirmText="Supprimer"
    cancelText="Annuler"
    type="danger"
    (confirmed)="confirmDeleteExpense()"
    (cancelled)="cancelDeleteExpense()">
  </app-confirm-dialog>

  <app-confirm-dialog
    [isOpen]="showDeleteSalaryConfirm"
    title="Supprimer le salaire"
    message="ÃŠtes-vous sÃ»r de vouloir supprimer ce salaire ?"
    confirmText="Supprimer"
    type="danger"
    (confirmed)="confirmDeleteSalary()"
    (cancelled)="cancelDeleteSalary()">
  </app-confirm-dialog>

  <app-confirm-dialog
    [isOpen]="showDeleteBudgetConfirm"
    title="Supprimer le budget"
    message="ÃŠtes-vous sÃ»r de vouloir supprimer ce budget ?"
    confirmText="Supprimer"
    type="danger"
    (confirmed)="confirmDeleteBudget()"
    (cancelled)="cancelDeleteBudget()">
  </app-confirm-dialog>

  <app-confirm-dialog
    [isOpen]="showDeleteSavingsConfirm"
    title="Supprimer l'objectif"
    message="ÃŠtes-vous sÃ»r de vouloir supprimer cet objectif d'Ã©pargne ?"
    confirmText="Supprimer"
    type="danger"
    (confirmed)="confirmDeleteSavingsGoal()"
    (cancelled)="cancelDeleteSavingsGoal()">
  </app-confirm-dialog>
</div>
