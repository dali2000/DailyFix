<div class="settings-page">
  <div class="settings-container">
    <h1>{{ 'settings.title' | translate }}</h1>

    <!-- Section Profil -->
    <section class="settings-section profile-section">
      <h2>{{ 'settings.profile' | translate }}</h2>
      <p class="section-desc">{{ 'settings.profileDesc' | translate }}</p>

      <div class="profile-card">
        <div class="profile-avatar-wrap">
          <div class="profile-avatar" [class.has-photo]="currentUser?.profilePhoto">
            <img *ngIf="currentUser?.profilePhoto" [src]="currentUser.profilePhoto" alt="" class="avatar-img">
            <span *ngIf="!currentUser?.profilePhoto" class="avatar-initials">{{ userInitials }}</span>
          </div>
          <input
            type="file"
            #photoInput
            accept="image/*"
            (change)="onPhotoSelected($event)"
            class="profile-photo-input"
            [attr.aria-label]="'settings.changePhoto' | translate">
          <button type="button" class="btn btn-secondary btn-change-photo" (click)="photoInput.click()" [disabled]="profilePhotoSaving">
            {{ profilePhotoSaving ? ('common.loading' | translate) : ('settings.changePhoto' | translate) }}
          </button>
          <p *ngIf="profilePhotoError" class="profile-photo-error">{{ profilePhotoError }}</p>
        </div>

        <div class="profile-fields">
          <div class="form-group">
            <label for="profile-fullName">{{ 'settings.fullNameLabel' | translate }}</label>
            <input
              id="profile-fullName"
              type="text"
              class="form-input"
              [(ngModel)]="profileFullName"
              [placeholder]="'settings.fullNameLabel' | translate"
              minlength="2">
          </div>
          <div class="form-group">
            <label>{{ 'common.email' | translate }}</label>
            <p class="profile-email-readonly">{{ currentUser?.email || '‚Äî' }}</p>
            <span class="profile-email-hint">{{ 'settings.emailNotEditable' | translate }}</span>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="profile-height">{{ 'settings.heightLabel' | translate }}</label>
              <input id="profile-height" type="number" class="form-input" [(ngModel)]="profileHeight" min="50" max="250" step="0.1" placeholder="170">
              <small class="form-hint">{{ 'settings.heightHint' | translate }}</small>
            </div>
            <div class="form-group">
              <label for="profile-weight">{{ 'settings.weightLabel' | translate }}</label>
              <input id="profile-weight" type="number" class="form-input" [(ngModel)]="profileWeight" min="20" max="300" step="0.1" placeholder="70">
              <small class="form-hint">{{ 'settings.weightHint' | translate }}</small>
            </div>
          </div>
          <div class="form-group">
            <label for="profile-gender">{{ 'settings.genderLabel' | translate }}</label>
            <select id="profile-gender" class="form-input" [(ngModel)]="profileGender">
              <option value="">{{ 'settings.genderPlaceholder' | translate }}</option>
              <option value="male">{{ 'settings.genderMale' | translate }}</option>
              <option value="female">{{ 'settings.genderFemale' | translate }}</option>
            </select>
            <small class="form-hint">{{ 'settings.healthProfileHint' | translate }}</small>
          </div>
          <button type="button" class="btn btn-primary" (click)="saveProfile()" [disabled]="profileSaving">
            {{ profileSaving ? ('common.loading' | translate) : ('settings.saveProfile' | translate) }}
          </button>
        </div>
      </div>
    </section>

    <!-- Section Apparence -->
    <section class="settings-section">
      <h2>{{ 'settings.appearance' | translate }}</h2>
      
      <div class="setting-item">
        <div class="setting-info">
          <h3>{{ 'settings.theme' | translate }}</h3>
          <p>{{ 'settings.themeDesc' | translate }}</p>
        </div>
        <div class="setting-control">
          <div class="theme-toggle">
            <button 
              class="theme-option" 
              [class.active]="currentTheme === 'light'"
              (click)="setTheme('light')"
              [attr.aria-label]="'settings.themeLight' | translate">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
              </svg>
              <span>{{ 'settings.themeLight' | translate }}</span>
            </button>
            <button 
              class="theme-option" 
              [class.active]="currentTheme === 'dark'"
              (click)="setTheme('dark')"
              [attr.aria-label]="'settings.themeDark' | translate">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
              </svg>
              <span>{{ 'settings.themeDark' | translate }}</span>
            </button>
            <button 
              class="theme-option" 
              [class.active]="currentTheme === 'blue'"
              (click)="setTheme('blue')"
              aria-label="Bleu">
              <span style="width: 12px; height: 12px; border-radius: 999px; background:#2563eb;"></span>
              <span>{{ 'settings.themeBlue' | translate }}</span>
            </button>
            <button 
              class="theme-option" 
              [class.active]="currentTheme === 'forest'"
              (click)="setTheme('forest')"
              aria-label="For√™t">
              <span style="width: 12px; height: 12px; border-radius: 999px; background:#15803d;"></span>
              <span>{{ 'settings.themeForest' | translate }}</span>
            </button>
            <button 
              class="theme-option" 
              [class.active]="currentTheme === 'purple'"
              (click)="setTheme('purple')"
              aria-label="Violet">
              <span style="width: 12px; height: 12px; border-radius: 999px; background:#7c3aed;"></span>
              <span>{{ 'settings.themePurple' | translate }}</span>
            </button>
          </div>
        </div>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h3>{{ 'settings.language' | translate }}</h3>
          <p>{{ 'settings.languageDesc' | translate }}</p>
        </div>
        <div class="setting-control">
          <select
            id="locale-select"
            class="currency-select"
            [(ngModel)]="selectedLocale"
            (ngModelChange)="onLocaleChange($event)"
          >
            <option *ngFor="let lang of languages" [value]="lang.code">
              {{ lang.label }}
            </option>
          </select>
        </div>
      </div>
    </section>

    <!-- Section Mes cat√©gories personnelles (d√©penses) -->
    <section class="settings-section custom-categories-section" [attr.aria-label]="'finance.myCategories' | translate">
      <h2><span class="custom-categories-emoji" aria-hidden="true">üè∑Ô∏è</span> {{ 'finance.myCategories' | translate }}</h2>
      <p class="section-desc">{{ 'finance.myCategoriesDesc' | translate }}</p>
      <div class="custom-categories-add">
        <input type="text" [(ngModel)]="categoryToAdd" [placeholder]="'finance.newCategoryPlaceholder' | translate" (keydown.enter)="$event.preventDefault(); addCustomCategory()">
        <button type="button" class="btn btn-primary" (click)="addCustomCategory()" [disabled]="!categoryToAdd.trim()">+ {{ 'finance.addCategoryButton' | translate }}</button>
      </div>
      <ul class="custom-categories-list" *ngIf="customCategoryList.length > 0">
        <li *ngFor="let cat of customCategoryList" class="custom-category-item">
          <span class="custom-category-icon">{{ getCategoryIcon(cat.name) }}</span>
          <span class="custom-category-name">{{ cat.name }}</span>
          <button type="button" class="btn-icon btn-icon-danger" (click)="removeCustomCategory(cat.id)" [attr.aria-label]="'common.delete' | translate" [title]="'finance.removeCategory' | translate">√ó</button>
        </li>
      </ul>
      <p *ngIf="customCategoryList.length === 0" class="custom-categories-empty">{{ 'finance.noCustomCategories' | translate }}</p>
    </section>

    <!-- Section Portefeuille -->
    <section class="settings-section settings-section-wallet">
      <h2>{{ 'settings.wallet' | translate }}</h2>

      <div class="setting-item">
        <div class="setting-info">
          <h3>{{ 'settings.currency' | translate }}</h3>
          <p>{{ 'settings.currencyDesc' | translate }}</p>
        </div>
        <div class="setting-control">
          <select
            id="currency-select"
            class="currency-select"
            [(ngModel)]="selectedCurrencyCode"
            (ngModelChange)="onCurrencyChange($event)"
          >
            <option *ngFor="let c of currencies" [value]="c.code">
              {{ c.label }} ({{ c.symbol }})
            </option>
          </select>
        </div>
      </div>
    </section>

    <!-- Section Compte -->
    <section class="settings-section">
      <h2>{{ 'settings.account' | translate }}</h2>
      
      <div class="setting-item">
        <div class="setting-info">
          <h3>{{ 'settings.userInfo' | translate }}</h3>
          <p *ngIf="currentUser">{{ currentUser.fullName }} ‚Äì {{ currentUser.email }}</p>
          <p *ngIf="!currentUser">{{ 'common.loading' | translate }}</p>
        </div>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h3>{{ 'nav.logout' | translate }}</h3>
          <p>{{ 'settings.logoutDesc' | translate }}</p>
        </div>
        <div class="setting-control">
          <button class="btn btn-danger" (click)="logout()">
            {{ 'settings.logoutBtn' | translate }}
          </button>
        </div>
      </div>
    </section>

    <!-- Section √Ä propos -->
    <section class="settings-section">
      <h2>{{ 'settings.about' | translate }}</h2>
      
      <div class="setting-item">
        <div class="setting-info">
          <h3>{{ 'settings.version' | translate }}</h3>
          <p>DailyFix v1.0.0</p>
        </div>
      </div>
    </section>
  </div>
</div>

