<div class="calendar-page">
  <div class="calendar-header">
    <h1>Calendrier</h1>
    <div class="header-actions">
      <button type="button" class="btn btn-primary" (click)="toggleEventForm()">
        + Nouvel Ã©vÃ©nement
      </button>
      <div class="view-controls">
        <button [class.active]="viewMode === 'month'" (click)="setViewMode('month')">Mois</button>
        <button [class.active]="viewMode === 'week'" (click)="setViewMode('week')">Semaine</button>
        <button [class.active]="viewMode === 'day'" (click)="setViewMode('day')">Jour</button>
      </div>
    </div>
  </div>

  <!-- Event Form Modal -->
  <app-modal
    *ngIf="showEventForm"
    [title]="editingEvent ? 'Modifier l\'Ã©vÃ©nement' : 'CrÃ©er un Ã©vÃ©nement'"
    size="md"
    (closeModal)="closeEventModal()"
  >
    <form (ngSubmit)="saveEvent()">
      <div class="form-group">
        <label for="event-title">Titre *</label>
        <input id="event-title" type="text" [(ngModel)]="newEvent.title" name="title" required placeholder="Titre de l'Ã©vÃ©nement">
      </div>
      <div class="form-group">
        <label for="event-desc">Description</label>
        <textarea id="event-desc" [(ngModel)]="newEvent.description" name="description" rows="3" placeholder="Description..."></textarea>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Type</label>
          <select [(ngModel)]="newEvent.type" name="type">
            <option value="event">Ã‰vÃ©nement</option>
            <option value="reminder">Rappel</option>
          </select>
        </div>
        <div class="form-group">
          <label>Couleur</label>
          <select [(ngModel)]="newEvent.color" name="color">
            <option *ngFor="let color of eventColors" [value]="color.value">
              {{ color.label }}
            </option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Date de dÃ©but *</label>
          <input type="date" [(ngModel)]="newEvent.startDate" name="startDate" required>
        </div>
        <div class="form-group">
          <label>Date de fin</label>
          <input type="date" [(ngModel)]="newEvent.endDate" name="endDate">
        </div>
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="closeEventModal()">Annuler</button>
        <button type="submit" class="btn btn-primary">Enregistrer</button>
      </div>
    </form>
  </app-modal>

  <div class="calendar-navigation">
    <button (click)="previousPeriod()" class="btn btn-primary">â† PrÃ©cÃ©dent</button>
    <h2 class="month-year-display">
      <span class="month-name">{{ getMonthNameOnly() }}</span>
      <span class="year-box">{{ getYear() }}</span>
    </h2>
    <div>
      <button (click)="goToToday()" class="btn btn-primary">Aujourd'hui</button>
      <button (click)="nextPeriod()" class="btn btn-primary">Suivant â†’</button>
    </div>
  </div>

  <div class="calendar-container">
    <div *ngIf="viewMode === 'month'" class="month-view">
      <div class="weekdays-header">
        <div *ngFor="let day of ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam']" class="weekday">
          {{ day }}
        </div>
      </div>
      <div class="days-grid">
        <div 
          *ngFor="let date of daysInMonth" 
          class="day-cell"
          [class.today]="isToday(date)"
          [class.other-month]="!isCurrentMonth(date)"
          [class.has-events]="hasEventsOnDate(date)"
          [style.border-left-color]="getEventColorForDate(date)"
          [style.background-color]="getEventBackgroundColor(date)"
          (click)="selectDate(date)">
          <div class="day-number">{{ getDayNumber(date) }}</div>
          <div class="day-events">
            <span *ngFor="let event of getEventsForDate(date).slice(0, 3)" 
                  class="event-dot" 
                  [style.background-color]="getEventColor(event)"></span>
            <span *ngIf="getEventsForDate(date).length > 3" class="more-events">
              +{{ getEventsForDate(date).length - 3 }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="viewMode === 'week'" class="week-view">
      <div class="weekdays-header">
        <div *ngFor="let day of weekDays" class="weekday">
          <div>{{ getDayName(day) }}</div>
          <div class="day-number">{{ getDayNumber(day) }}</div>
        </div>
      </div>
      <div class="week-days-grid">
        <div *ngFor="let day of weekDays" 
             class="week-day-column"
             [class.has-events]="hasEventsOnDate(day)"
             [style.border-left-color]="getEventColorForDate(day)"
             [style.background-color]="getEventBackgroundColor(day)">
          <div class="day-events-list">
            <div *ngFor="let event of getEventsForDate(day)" class="event-item" [style.border-left-color]="getEventColor(event)">
              <div class="event-title">{{ event.title }}</div>
              <div *ngIf="event.description" class="event-description">{{ event.description }}</div>
              <div class="event-time">{{ getEventDate(event) | date:'short' }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="viewMode === 'day'" class="day-view">
      <div class="selected-day-header">
        <h3>{{ selectedDate ? (selectedDate | date:'fullDate') : (currentDate | date:'fullDate') }}</h3>
      </div>
      <div class="day-details">
        <div class="events-section">
          <h4>Ã‰vÃ©nements et Rappels</h4>
          <div *ngIf="getEventsForDate(selectedDate || currentDate).length === 0" class="empty">
            Aucun Ã©vÃ©nement ou rappel
          </div>
          <div *ngFor="let event of getEventsForDate(selectedDate || currentDate)" class="event-card" [style.border-left-color]="getEventColor(event)">
            <div class="event-header">
              <h5>{{ event.title }}</h5>
              <div class="event-actions" *ngIf="isCalendarEvent(event)">
                <button class="icon-btn" (click)="editEvent(event)" title="Modifier">âœï¸</button>
                <button class="icon-btn" (click)="deleteEvent(event)" title="Supprimer">ğŸ—‘ï¸</button>
              </div>
            </div>
            <p *ngIf="event.description">{{ event.description }}</p>
            <div class="event-meta">
              <small>{{ getEventDate(event) | date:'short' }}</small>
              <span *ngIf="isCalendarEvent(event)" class="event-type-badge">
                {{ event.type === 'reminder' ? 'ğŸ”” Rappel' : 'ğŸ“… Ã‰vÃ©nement' }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="selectedDate" class="selected-date-panel">
    <h3>{{ selectedDate | date:'fullDate' }}</h3>
    <div class="selected-events">
      <h4>Ã‰vÃ©nements et Rappels ({{ eventsForSelectedDate.length }})</h4>
      <div *ngIf="eventsForSelectedDate.length === 0" class="empty">
        Aucun Ã©vÃ©nement ou rappel pour cette date
      </div>
      <div *ngFor="let event of eventsForSelectedDate" class="event-item" [style.border-left-color]="getEventColor(event)">
        <div class="event-title">{{ event.title }}</div>
        <div *ngIf="event.description" class="event-description">{{ event.description }}</div>
        <div class="event-meta">
          <small>{{ getEventDate(event) | date:'short' }}</small>
          <span *ngIf="isCalendarEvent(event)" class="event-type-badge">
            {{ event.type === 'reminder' ? 'ğŸ”” Rappel' : 'ğŸ“… Ã‰vÃ©nement' }}
          </span>
        </div>
        <div class="event-actions" *ngIf="isCalendarEvent(event)">
          <button class="icon-btn" (click)="editEvent(event)" title="Modifier">âœï¸</button>
          <button class="icon-btn" (click)="deleteEvent(event)" title="Supprimer">ğŸ—‘ï¸</button>
        </div>
      </div>
    </div>
  </div>
</div>

