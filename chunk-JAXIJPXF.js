import{Ya as S,ab as v,g as s,h as p,k as u,l,n as r,q as m,t as o}from"./chunk-JODBZJDH.js";import{a as n,b as h}from"./chunk-POLL2CVR.js";var $=(()=>{class c{constructor(t,e){this.authService=t,this.apiService=e,this.meals=[],this.activities=[],this.sleepRecords=[],this.waterIntakes=[],this.meditationSessions=[],this.mealsCache$=null,this.activitiesCache$=null,this.sleepCache$=null,this.waterCache$=null,this.meditationCache$=null,this.authService.currentUser$.pipe(u()).subscribe(i=>{i!==null?this.loadAll():(this.meals=[],this.activities=[],this.sleepRecords=[],this.waterIntakes=[],this.meditationSessions=[],this.mealsCache$=null,this.activitiesCache$=null,this.sleepCache$=null,this.waterCache$=null,this.meditationCache$=null)})}getMeals(){return[...this.meals]}getMealsObservable(){return this.mealsCache$||(this.mealsCache$=this.apiService.get("/health/meals").pipe(s(t=>t.data||[]),r(t=>this.meals=t.map(e=>h(n({},e),{id:e.id.toString(),date:new Date(e.date)}))),l(1))),this.mealsCache$}addMeal(t){return this.apiService.post("/health/meals",t).pipe(s(e=>e.data),r(e=>{this.meals.push(h(n({},e),{id:e.id.toString(),date:new Date(e.date)}))}))}updateMeal(t,e){return this.apiService.put(`/health/meals/${t}`,e).pipe(s(i=>i.data),r(i=>{let a=this.meals.findIndex(d=>d.id===t);a!==-1&&(this.meals[a]=h(n({},i),{id:i.id.toString(),date:new Date(i.date)}))}))}deleteMeal(t){return this.apiService.delete(`/health/meals/${t}`).pipe(s(e=>e.success),r(()=>{let e=this.meals.findIndex(i=>i.id===t);e!==-1&&this.meals.splice(e,1)}))}getMealsForDate(t){let e=t.toDateString();return this.meals.filter(i=>new Date(i.date).toDateString()===e)}getTodayCalories(){let t=new Date;return this.getMealsForDate(t).reduce((e,i)=>e+(i.calories||0),0)}getActivities(){return[...this.activities]}getActivitiesObservable(){return this.activitiesCache$||(this.activitiesCache$=this.apiService.get("/health/activities").pipe(s(t=>t.data||[]),r(t=>this.activities=t.map(e=>h(n({},e),{id:e.id.toString(),date:new Date(e.date)}))),l(1))),this.activitiesCache$}addActivity(t){return this.apiService.post("/health/activities",t).pipe(s(e=>e.data),r(e=>{this.activities.push(h(n({},e),{id:e.id.toString(),date:new Date(e.date)}))}))}updateActivity(t,e){return this.apiService.put(`/health/activities/${t}`,e).pipe(s(i=>i.data),r(i=>{let a=this.activities.findIndex(d=>d.id===t);a!==-1&&(this.activities[a]=h(n({},i),{id:i.id.toString(),date:new Date(i.date)}))}))}deleteActivity(t){return this.apiService.delete(`/health/activities/${t}`).pipe(s(e=>e.success),r(()=>{let e=this.activities.findIndex(i=>i.id===t);e!==-1&&this.activities.splice(e,1)}))}getActivitiesForDate(t){let e=t.toDateString();return this.activities.filter(i=>new Date(i.date).toDateString()===e)}getTodayActivityMinutes(){let t=new Date;return this.getActivitiesForDate(t).reduce((e,i)=>e+i.duration,0)}getSleepRecords(){return[...this.sleepRecords]}getSleepRecordsObservable(){return this.sleepCache$||(this.sleepCache$=this.apiService.get("/health/sleep").pipe(s(t=>t.data||[]),r(t=>this.sleepRecords=t.map(e=>h(n({},e),{id:e.id.toString(),date:new Date(e.date),sleepTime:new Date(e.sleepTime),wakeTime:new Date(e.wakeTime)}))),l(1))),this.sleepCache$}addSleepRecord(t){let e=(new Date(t.wakeTime).getTime()-new Date(t.sleepTime).getTime())/36e5,i=h(n({},t),{hours:Math.round(e*10)/10});return this.apiService.post("/health/sleep",i).pipe(s(a=>a.data),r(a=>{this.sleepRecords.push(h(n({},a),{id:a.id.toString(),date:new Date(a.date),sleepTime:new Date(a.sleepTime),wakeTime:new Date(a.wakeTime)}))}))}updateSleepRecord(t,e){return this.apiService.put(`/health/sleep/${t}`,e).pipe(s(i=>i.data),r(i=>{let a=this.sleepRecords.findIndex(d=>d.id===t);a!==-1&&(this.sleepRecords[a]=h(n({},i),{id:i.id.toString(),date:new Date(i.date),sleepTime:new Date(i.sleepTime),wakeTime:new Date(i.wakeTime)}))}))}deleteSleepRecord(t){return this.apiService.delete(`/health/sleep/${t}`).pipe(s(e=>e.success),r(()=>{let e=this.sleepRecords.findIndex(i=>i.id===t);e!==-1&&this.sleepRecords.splice(e,1)}))}getLastSleepRecord(){return this.sleepRecords.length>0?this.sleepRecords.sort((t,e)=>new Date(e.date).getTime()-new Date(t.date).getTime())[0]:void 0}getWaterIntakes(){return[...this.waterIntakes]}getWaterIntakesObservable(){return this.waterCache$||(this.waterCache$=this.apiService.get("/health/water").pipe(s(t=>t.data||[]),r(t=>this.waterIntakes=t.map(e=>h(n({},e),{id:e.id.toString(),date:new Date(e.date)}))),l(1))),this.waterCache$}addWaterIntake(t){return this.apiService.post("/health/water",t).pipe(s(e=>e.data),r(e=>{this.waterIntakes.push(h(n({},e),{id:e.id.toString(),date:new Date(e.date)}))}))}updateWaterIntake(t,e){return this.apiService.put(`/health/water/${t}`,e).pipe(s(i=>i.data),r(i=>{let a=this.waterIntakes.findIndex(d=>d.id===t);a!==-1&&(this.waterIntakes[a]=h(n({},i),{id:i.id.toString(),date:new Date(i.date)}))}))}deleteWaterIntake(t){return this.apiService.delete(`/health/water/${t}`).pipe(s(e=>e.success),r(()=>{let e=this.waterIntakes.findIndex(i=>i.id===t);e!==-1&&this.waterIntakes.splice(e,1)}))}getTodayWaterIntake(){let e=new Date().toDateString();return this.waterIntakes.filter(i=>new Date(i.date).toDateString()===e).reduce((i,a)=>i+Number(a.amount),0)}getMeditationSessions(){return[...this.meditationSessions]}getMeditationSessionsObservable(){return this.meditationCache$||(this.meditationCache$=this.apiService.get("/health/meditation").pipe(s(t=>t.data||[]),r(t=>this.meditationSessions=t.map(e=>h(n({},e),{id:e.id.toString(),date:new Date(e.date)}))),l(1))),this.meditationCache$}addMeditationSession(t){return this.apiService.post("/health/meditation",t).pipe(s(e=>e.data),r(e=>{this.meditationSessions.push(h(n({},e),{id:e.id.toString(),date:new Date(e.date)}))}))}updateMeditationSession(t,e){return this.apiService.put(`/health/meditation/${t}`,e).pipe(s(i=>i.data),r(i=>{let a=this.meditationSessions.findIndex(d=>d.id===t);a!==-1&&(this.meditationSessions[a]=h(n({},i),{id:i.id.toString(),date:new Date(i.date)}))}))}deleteMeditationSession(t){return this.apiService.delete(`/health/meditation/${t}`).pipe(s(e=>e.success),r(()=>{let e=this.meditationSessions.findIndex(i=>i.id===t);e!==-1&&this.meditationSessions.splice(e,1)}))}loadAll(){this.authService.isAuthenticated()?p({meals:this.getMealsObservable(),activities:this.getActivitiesObservable(),sleep:this.getSleepRecordsObservable(),water:this.getWaterIntakesObservable(),meditation:this.getMeditationSessionsObservable()}).subscribe({error:t=>console.error("Error loading health data:",t)}):(this.meals=[],this.activities=[],this.sleepRecords=[],this.waterIntakes=[],this.meditationSessions=[])}static{this.\u0275fac=function(e){return new(e||c)(o(v),o(S))}}static{this.\u0275prov=m({token:c,factory:c.\u0275fac,providedIn:"root"})}}return c})();export{$ as a};
