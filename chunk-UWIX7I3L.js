import{Ya as S,ab as v,g as r,h as p,k as g,l as u,n as i,q as f,t as h}from"./chunk-JODBZJDH.js";import{a as l,b as o}from"./chunk-POLL2CVR.js";var $=(()=>{class d{constructor(t,e){this.authService=t,this.apiService=e,this.journalEntries=[],this.personalGoals=[],this.stressRecords=[],this.journalCache$=null,this.goalsCache$=null,this.stressCache$=null,this.authService.currentUser$.pipe(g()).subscribe(s=>{s!==null?this.loadAll():(this.journalEntries=[],this.personalGoals=[],this.stressRecords=[],this.journalCache$=null,this.goalsCache$=null,this.stressCache$=null)})}getJournalEntries(){return[...this.journalEntries].sort((t,e)=>new Date(e.date).getTime()-new Date(t.date).getTime())}getJournalEntriesObservable(){return this.journalCache$||(this.journalCache$=this.apiService.get("/wellness/journal").pipe(r(t=>t.data||[]),i(t=>this.journalEntries=t.map(e=>o(l({},e),{id:e.id.toString(),date:new Date(e.date)}))),u(1))),this.journalCache$}getJournalEntryById(t){return this.journalEntries.find(e=>e.id===t)}getJournalEntryByIdObservable(t){return this.apiService.get(`/wellness/journal/${t}`).pipe(r(e=>e.data))}addJournalEntry(t){return this.apiService.post("/wellness/journal",t).pipe(r(e=>e.data),i(e=>{this.journalEntries.push(o(l({},e),{id:e.id.toString(),date:new Date(e.date)}))}))}updateJournalEntry(t,e){return this.apiService.put(`/wellness/journal/${t}`,e).pipe(r(s=>s.data),i(s=>{let n=this.journalEntries.findIndex(a=>a.id===t);n!==-1&&(this.journalEntries[n]=o(l({},s),{id:s.id.toString(),date:new Date(s.date)}))}))}deleteJournalEntry(t){return this.apiService.delete(`/wellness/journal/${t}`).pipe(r(e=>e.success),i(()=>{let e=this.journalEntries.findIndex(s=>s.id===t);e!==-1&&this.journalEntries.splice(e,1)}))}getPersonalGoals(){return[...this.personalGoals]}getPersonalGoalsObservable(){return this.goalsCache$||(this.goalsCache$=this.apiService.get("/wellness/goals").pipe(r(t=>t.data||[]),i(t=>this.personalGoals=t.map(e=>o(l({},e),{id:e.id.toString(),targetDate:e.targetDate?new Date(e.targetDate):void 0}))),u(1))),this.goalsCache$}getPersonalGoalById(t){return this.personalGoals.find(e=>e.id===t)}getPersonalGoalByIdObservable(t){return this.apiService.get(`/wellness/goals/${t}`).pipe(r(e=>e.data))}addPersonalGoal(t){return this.apiService.post("/wellness/goals",t).pipe(r(e=>e.data),i(e=>{this.personalGoals.push(o(l({},e),{id:e.id.toString(),targetDate:e.targetDate?new Date(e.targetDate):void 0}))}))}updatePersonalGoal(t,e){return this.apiService.put(`/wellness/goals/${t}`,e).pipe(r(s=>s.data),i(s=>{let n=this.personalGoals.findIndex(a=>a.id===t);n!==-1&&(this.personalGoals[n]=o(l({},s),{id:s.id.toString(),targetDate:s.targetDate?new Date(s.targetDate):void 0}))}))}deletePersonalGoal(t){return this.apiService.delete(`/wellness/goals/${t}`).pipe(r(e=>e.success),i(()=>{let e=this.personalGoals.findIndex(s=>s.id===t);e!==-1&&this.personalGoals.splice(e,1)}))}getStressRecords(){return[...this.stressRecords]}getStressRecordsObservable(){return this.stressCache$||(this.stressCache$=this.apiService.get("/wellness/stress").pipe(r(t=>t.data||[]),i(t=>this.stressRecords=t.map(e=>o(l({},e),{id:e.id.toString(),date:new Date(e.date)}))),u(1))),this.stressCache$}getStressRecordById(t){return this.stressRecords.find(e=>e.id===t)}getStressRecordByIdObservable(t){return this.apiService.get(`/wellness/stress/${t}`).pipe(r(e=>e.data))}addStressRecord(t){return this.apiService.post("/wellness/stress",t).pipe(r(e=>e.data),i(e=>{this.stressRecords.push(o(l({},e),{id:e.id.toString(),date:new Date(e.date)}))}))}updateStressRecord(t,e){return this.apiService.put(`/wellness/stress/${t}`,e).pipe(r(s=>s.data),i(s=>{let n=this.stressRecords.findIndex(a=>a.id===t);n!==-1&&(this.stressRecords[n]=o(l({},s),{id:s.id.toString(),date:new Date(s.date)}))}))}deleteStressRecord(t){return this.apiService.delete(`/wellness/stress/${t}`).pipe(r(e=>e.success),i(()=>{let e=this.stressRecords.findIndex(s=>s.id===t);e!==-1&&this.stressRecords.splice(e,1)}))}getActiveGoals(){return this.personalGoals.filter(t=>!t.completed)}getCompletedGoals(){return this.personalGoals.filter(t=>t.completed)}getAverageStressLevel(t){let e=new Date;e.setDate(e.getDate()-t);let s=this.stressRecords.filter(a=>(a.date instanceof Date?a.date:new Date(a.date))>=e);if(s.length===0)return 0;let n=s.reduce((a,c)=>a+c.stressLevel,0);return Math.round(n/s.length*10)/10}getStressManagementTips(){return["Pratiquez la respiration profonde pendant 5 minutes","Faites une promenade de 10 minutes","\xC9coutez de la musique apaisante","Essayez la m\xE9ditation guid\xE9e","Prenez une pause et buvez un verre d'eau","Faites quelques \xE9tirements","Parlez \xE0 un ami ou un proche","Notez vos pens\xE9es dans un journal"]}loadAll(){this.authService.isAuthenticated()?p({journal:this.getJournalEntriesObservable(),goals:this.getPersonalGoalsObservable(),stress:this.getStressRecordsObservable()}).subscribe({error:t=>console.error("Error loading wellness data:",t)}):(this.journalEntries=[],this.personalGoals=[],this.stressRecords=[])}static{this.\u0275fac=function(e){return new(e||d)(h(v),h(S))}}static{this.\u0275prov=f({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})();export{$ as a};
