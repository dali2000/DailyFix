import{La as v,Ma as k,a as p,b as o,j as i,n as u,p as a,s as c,v as h}from"./chunk-76YESKQ4.js";var D=(()=>{class r{constructor(t,e){this.authService=t,this.apiService=e,this.tasks=[],this.events=[],this.authService.currentUser$.pipe(u()).subscribe(s=>{s!==null?(this.loadTasks(),this.loadEvents()):(this.tasks=[],this.events=[])})}getTasks(){return[...this.tasks]}getTasksObservable(){return this.apiService.get("/tasks").pipe(i(t=>t.data||[]),a(t=>this.tasks=t))}getTaskById(t){return this.tasks.find(e=>e.id===t)}getTaskByIdObservable(t){return this.apiService.get(`/tasks/${t}`).pipe(i(e=>e.data))}addTask(t){return this.apiService.post("/tasks",t).pipe(i(e=>e.data),a(e=>{this.tasks.push(e)}))}updateTask(t,e){return this.apiService.put(`/tasks/${t}`,e).pipe(i(s=>s.data),a(s=>{let n=this.tasks.findIndex(d=>d.id===t);n!==-1&&(this.tasks[n]=s)}))}deleteTask(t){return this.apiService.delete(`/tasks/${t}`).pipe(i(e=>e.success),a(()=>{let e=this.tasks.findIndex(s=>s.id===t);e!==-1&&this.tasks.splice(e,1)}))}getTasksForDate(t){let e=t.toDateString();return this.tasks.filter(s=>s.dueDate&&new Date(s.dueDate).toDateString()===e)}getTasksByStatus(t){return this.apiService.get(`/tasks/status/${t}`).pipe(i(e=>e.data||[]))}updateTaskStatus(t,e){return this.updateTask(t,{status:e})}getCompletedTasksCount(){return this.tasks.filter(t=>t.completed).length}getTotalTasksCount(){return this.tasks.length}getEvents(){return[...this.events]}getEventsObservable(){return this.apiService.get("/events").pipe(i(t=>t.data||[]),a(t=>this.events=t))}addEvent(t){return this.apiService.post("/events",t).pipe(i(e=>e.data),a(e=>{this.events.push(e)}))}updateEvent(t,e){return this.apiService.put(`/events/${t}`,e).pipe(i(s=>s.data),a(s=>{let n=this.events.findIndex(d=>d.id===t);n!==-1&&(this.events[n]=s)}))}deleteEvent(t){return this.apiService.delete(`/events/${t}`).pipe(i(e=>e.success),a(()=>{let e=this.events.findIndex(s=>s.id===t);e!==-1&&this.events.splice(e,1)}))}getEventsForDate(t){let e=t.toDateString();return this.events.filter(s=>new Date(s.startDate).toDateString()===e)}getEventsForDateObservable(t){let e=t.toISOString().split("T")[0];return this.apiService.get(`/events/date/${e}`).pipe(i(s=>s.data||[]))}loadTasks(){this.authService.isAuthenticated()?this.getTasksObservable().subscribe({next:t=>{this.tasks=t.map(e=>o(p({},e),{id:e.id.toString(),status:e.status||(e.completed?"done":"todo"),priority:e.priority||"medium",dueDate:e.dueDate?new Date(e.dueDate):void 0,reminder:e.reminder?new Date(e.reminder):void 0,createdAt:new Date(e.createdAt),updatedAt:e.updatedAt?new Date(e.updatedAt):new Date(e.createdAt)}))},error:t=>{console.error("Error loading tasks:",t),this.tasks=[]}}):this.tasks=[]}loadEvents(){this.authService.isAuthenticated()?this.getEventsObservable().subscribe({next:t=>{this.events=t.map(e=>o(p({},e),{id:e.id.toString(),startDate:new Date(e.startDate),endDate:e.endDate?new Date(e.endDate):void 0}))},error:t=>{console.error("Error loading events:",t),this.events=[]}}):this.events=[]}static{this.\u0275fac=function(e){return new(e||r)(h(k),h(v))}}static{this.\u0275prov=c({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{D as a};
