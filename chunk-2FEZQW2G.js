import{Qa as v,Ta as l,a as o,b as p,j as i,n as h,p as a,s as c,v as u}from"./chunk-DTRZGNSU.js";var D=(()=>{class r{constructor(e,t){this.authService=e,this.apiService=t,this.tasks=[],this.events=[],this.authService.currentUser$.pipe(h()).subscribe(s=>{s!==null?(this.loadTasks(),this.loadEvents()):(this.tasks=[],this.events=[])})}getTasks(){return[...this.tasks]}getTasksObservable(){return this.apiService.get("/tasks").pipe(i(e=>e.data||[]),a(e=>this.tasks=e))}getTaskById(e){return this.tasks.find(t=>t.id===e)}getTaskByIdObservable(e){return this.apiService.get(`/tasks/${e}`).pipe(i(t=>t.data))}addTask(e){return this.apiService.post("/tasks",e).pipe(i(t=>t.data),a(t=>{this.tasks.push(t)}))}updateTask(e,t){return this.apiService.put(`/tasks/${e}`,t).pipe(i(s=>s.data),a(s=>{let n=this.tasks.findIndex(d=>d.id===e);n!==-1&&(this.tasks[n]=s)}))}deleteTask(e){return this.apiService.delete(`/tasks/${e}`).pipe(i(t=>t.success),a(()=>{let t=this.tasks.findIndex(s=>s.id===e);t!==-1&&this.tasks.splice(t,1)}))}getTasksForDate(e){let t=e.toDateString();return this.tasks.filter(s=>s.dueDate&&new Date(s.dueDate).toDateString()===t)}getTasksByStatus(e){return this.apiService.get(`/tasks/status/${e}`).pipe(i(t=>t.data||[]))}updateTaskStatus(e,t){return this.updateTask(e,{status:t})}getCompletedTasksCount(){return this.tasks.filter(e=>e.completed).length}getTasksCompletedTodayCount(){let e=new Date().toDateString();return this.tasks.filter(t=>{if(t.status!=="done"&&!t.completed)return!1;let s=t.updatedAt?new Date(t.updatedAt):null;return s&&s.toDateString()===e}).length}getTotalTasksCount(){return this.tasks.length}getEvents(){return[...this.events]}getEventsObservable(){return this.apiService.get("/events").pipe(i(e=>e.data||[]),a(e=>this.events=e))}addEvent(e){return this.apiService.post("/events",e).pipe(i(t=>t.data),a(t=>{this.events.push(t)}))}updateEvent(e,t){return this.apiService.put(`/events/${e}`,t).pipe(i(s=>s.data),a(s=>{let n=this.events.findIndex(d=>d.id===e);n!==-1&&(this.events[n]=s)}))}deleteEvent(e){return this.apiService.delete(`/events/${e}`).pipe(i(t=>t.success),a(()=>{let t=this.events.findIndex(s=>s.id===e);t!==-1&&this.events.splice(t,1)}))}getEventsForDate(e){let t=e.toDateString();return this.events.filter(s=>new Date(s.startDate).toDateString()===t)}getEventsForDateObservable(e){let t=e.toISOString().split("T")[0];return this.apiService.get(`/events/date/${t}`).pipe(i(s=>s.data||[]))}loadTasks(){this.authService.isAuthenticated()?this.getTasksObservable().subscribe({next:e=>{this.tasks=e.map(t=>p(o({},t),{id:t.id.toString(),status:t.status||(t.completed?"done":"todo"),priority:t.priority||"medium",dueDate:t.dueDate?new Date(t.dueDate):void 0,reminder:t.reminder?new Date(t.reminder):void 0,createdAt:new Date(t.createdAt),updatedAt:t.updatedAt?new Date(t.updatedAt):new Date(t.createdAt)}))},error:e=>{console.error("Error loading tasks:",e),this.tasks=[]}}):this.tasks=[]}loadEvents(){this.authService.isAuthenticated()?this.getEventsObservable().subscribe({next:e=>{this.events=e.map(t=>p(o({},t),{id:t.id.toString(),startDate:new Date(t.startDate),endDate:t.endDate?new Date(t.endDate):void 0}))},error:e=>{console.error("Error loading events:",e),this.events=[]}}):this.events=[]}static{this.\u0275fac=function(t){return new(t||r)(u(l),u(v))}}static{this.\u0275prov=c({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{D as a};
