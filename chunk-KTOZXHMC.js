import{Ta as v,Xa as l,d as p,g as i,k as c,m as a,p as k,s as h}from"./chunk-AJ37PTJK.js";import{a as o,b as u}from"./chunk-POLL2CVR.js";var m=(()=>{class r{constructor(t,e){this.authService=t,this.apiService=e,this.tasks=[],this.tasksSubject=new p([]),this.events=[],this.authService.currentUser$.pipe(c()).subscribe(s=>{s!==null?(this.loadTasks(),this.loadEvents()):(this.tasks=[],this.tasksSubject.next([]),this.events=[])})}getTasks(){return[...this.tasks]}getTasksObservable(){return this.tasksSubject.asObservable()}getTaskById(t){return this.tasks.find(e=>e.id===t)}getTaskByIdObservable(t){return this.apiService.get(`/tasks/${t}`).pipe(i(e=>e.data))}addTask(t){return this.apiService.post("/tasks",t).pipe(i(e=>e.data),a(e=>{let s=this.normalizeTask(e);this.tasks.push(s),this.tasksSubject.next([...this.tasks])}))}updateTask(t,e){return this.apiService.put(`/tasks/${t}`,e).pipe(i(s=>s.data),a(s=>{let n=this.normalizeTask(s),d=this.tasks.findIndex(S=>S.id===t);d!==-1&&(this.tasks[d]=n),this.tasksSubject.next([...this.tasks])}))}deleteTask(t){return this.apiService.delete(`/tasks/${t}`).pipe(i(e=>e.success),a(()=>{let e=this.tasks.findIndex(s=>s.id===t);e!==-1&&this.tasks.splice(e,1),this.tasksSubject.next([...this.tasks])}))}getTasksForDate(t){let e=t.toDateString();return this.tasks.filter(s=>s.dueDate&&new Date(s.dueDate).toDateString()===e)}getTasksByStatus(t){return this.apiService.get(`/tasks/status/${t}`).pipe(i(e=>e.data||[]))}updateTaskStatus(t,e){return this.updateTask(t,{status:e})}getCompletedTasksCount(){return this.tasks.filter(t=>t.completed).length}getTasksCompletedTodayCount(){let t=new Date().toDateString();return this.tasks.filter(e=>{if(e.status!=="done"&&!e.completed)return!1;let s=e.updatedAt?new Date(e.updatedAt):null;return s&&s.toDateString()===t}).length}getTotalTasksCount(){return this.tasks.length}getEvents(){return[...this.events]}getEventsObservable(){return this.apiService.get("/events").pipe(i(t=>t.data||[]),a(t=>this.events=t))}addEvent(t){return this.apiService.post("/events",t).pipe(i(e=>e.data),a(e=>{this.events.push(e)}))}updateEvent(t,e){return this.apiService.put(`/events/${t}`,e).pipe(i(s=>s.data),a(s=>{let n=this.events.findIndex(d=>d.id===t);n!==-1&&(this.events[n]=s)}))}deleteEvent(t){return this.apiService.delete(`/events/${t}`).pipe(i(e=>e.success),a(()=>{let e=this.events.findIndex(s=>s.id===t);e!==-1&&this.events.splice(e,1)}))}getEventsForDate(t){let e=t.toDateString();return this.events.filter(s=>new Date(s.startDate).toDateString()===e)}getEventsForDateObservable(t){let e=t.toISOString().split("T")[0];return this.apiService.get(`/events/date/${e}`).pipe(i(s=>s.data||[]))}normalizeTask(t){return u(o({},t),{id:t.id?.toString()??t.id,status:t.status||(t.completed?"done":"todo"),priority:t.priority||"medium",dueDate:t.dueDate?new Date(t.dueDate):void 0,reminder:t.reminder?new Date(t.reminder):void 0,createdAt:new Date(t.createdAt),updatedAt:t.updatedAt?new Date(t.updatedAt):new Date(t.createdAt)})}loadTasks(){if(!this.authService.isAuthenticated()){this.tasks=[],this.tasksSubject.next([]);return}this.apiService.get("/tasks").pipe(i(t=>(t.data||[]).map(e=>this.normalizeTask(e)))).subscribe({next:t=>{this.tasks=t,this.tasksSubject.next([...this.tasks])},error:t=>{console.error("Error loading tasks:",t),this.tasks=[],this.tasksSubject.next([])}})}loadEvents(){this.authService.isAuthenticated()?this.getEventsObservable().subscribe({next:t=>{this.events=t.map(e=>u(o({},e),{id:e.id.toString(),startDate:new Date(e.startDate),endDate:e.endDate?new Date(e.endDate):void 0}))},error:t=>{console.error("Error loading events:",t),this.events=[]}}):this.events=[]}static{this.\u0275fac=function(e){return new(e||r)(h(l),h(v))}}static{this.\u0275prov=k({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{m as a};
