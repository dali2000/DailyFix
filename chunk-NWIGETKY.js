import{Aa as S,a as r,b as l,m as d,p as c}from"./chunk-TB66C4D3.js";var x=(()=>{class g{constructor(t){this.authService=t,this.expenses=[],this.budgets=[],this.savingsGoals=[],this.salaries=[],this.authService.currentUser$.subscribe(()=>{this.loadFromStorage()}),this.loadFromStorage()}getExpenses(){return[...this.expenses]}addExpense(t){let e=l(r({},t),{id:this.generateId()});return this.expenses.push(e),this.saveToStorage(),e}updateExpense(t,e){let s=this.expenses.findIndex(a=>a.id===t);return s===-1?null:(this.expenses[s]=r(r({},this.expenses[s]),e),this.saveToStorage(),this.expenses[s])}deleteExpense(t){let e=this.expenses.findIndex(s=>s.id===t);return e===-1?!1:(this.expenses.splice(e,1),this.saveToStorage(),!0)}getExpensesForMonth(t,e){return this.expenses.filter(s=>{let a=new Date(s.date);return a.getFullYear()===t&&a.getMonth()===e})}getTotalExpensesForMonth(t,e){return this.getExpensesForMonth(t,e).reduce((s,a)=>s+a.amount,0)}getExpensesByCategory(t){return this.expenses.filter(e=>e.category===t)}getBudgets(){return[...this.budgets]}addBudget(t){let e=l(r({},t),{id:this.generateId(),spent:0});return this.budgets.push(e),this.saveToStorage(),e}updateBudget(t,e){let s=this.budgets.findIndex(a=>a.id===t);return s===-1?null:(this.budgets[s]=r(r({},this.budgets[s]),e),this.saveToStorage(),this.budgets[s])}deleteBudget(t){let e=this.budgets.findIndex(s=>s.id===t);return e===-1?!1:(this.budgets.splice(e,1),this.saveToStorage(),!0)}getMonthlyBudget(){return this.budgets.filter(e=>e.period==="monthly").reduce((e,s)=>e+s.limit,0)}getRemainingBudget(){let t=new Date,e=this.getTotalExpensesForMonth(t.getFullYear(),t.getMonth());return this.getMonthlyBudget()-e}getSalaries(){return[...this.salaries]}addSalary(t){let e=l(r({},t),{id:this.generateId()});return this.salaries.push(e),this.saveToStorage(),e}updateSalary(t,e){let s=this.salaries.findIndex(a=>a.id===t);return s===-1?null:(this.salaries[s]=r(r({},this.salaries[s]),e),this.saveToStorage(),this.salaries[s])}deleteSalary(t){let e=this.salaries.findIndex(s=>s.id===t);return e===-1?!1:(this.salaries.splice(e,1),this.saveToStorage(),!0)}getMonthlySalary(){let t=new Date,s=this.salaries.filter(n=>{let i=new Date(n.date);return n.period==="monthly"&&i.getFullYear()===t.getFullYear()&&i.getMonth()===t.getMonth()}).reduce((n,i)=>n+i.amount,0),h=this.salaries.filter(n=>{let i=new Date(n.date);return n.period==="yearly"&&i.getFullYear()===t.getFullYear()}).reduce((n,i)=>n+i.amount/12,0);return s+h}getRemainingBalance(){let t=this.getMonthlySalary(),e=new Date,s=this.getTotalExpensesForMonth(e.getFullYear(),e.getMonth());return t-s}getSavingsGoals(){return[...this.savingsGoals]}addSavingsGoal(t){let e=l(r({},t),{id:this.generateId()});return this.savingsGoals.push(e),this.saveToStorage(),e}updateSavingsGoal(t,e){let s=this.savingsGoals.findIndex(a=>a.id===t);return s===-1?null:(this.savingsGoals[s]=r(r({},this.savingsGoals[s]),e),this.saveToStorage(),this.savingsGoals[s])}deleteSavingsGoal(t){let e=this.savingsGoals.findIndex(s=>s.id===t);return e===-1?!1:(this.savingsGoals.splice(e,1),this.saveToStorage(),!0)}getSavingsSuggestions(){let t=[],e=new Date,s=this.getTotalExpensesForMonth(e.getFullYear(),e.getMonth());return s>0&&(this.getExpensesByCategory("food").reduce((n,i)=>n+i.amount,0)>s*.3&&t.push("Consid\xE9rez r\xE9duire les d\xE9penses alimentaires en cuisinant plus \xE0 la maison"),this.getExpensesByCategory("leisure").reduce((n,i)=>n+i.amount,0)>s*.2&&t.push("R\xE9duisez les d\xE9penses de loisirs en cherchant des activit\xE9s gratuites")),t}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}saveToStorage(){let t=this.authService.getUserStorageKey("expenses"),e=this.authService.getUserStorageKey("budgets"),s=this.authService.getUserStorageKey("savingsGoals"),a=this.authService.getUserStorageKey("salaries");localStorage.setItem(t,JSON.stringify(this.expenses)),localStorage.setItem(e,JSON.stringify(this.budgets)),localStorage.setItem(s,JSON.stringify(this.savingsGoals)),localStorage.setItem(a,JSON.stringify(this.salaries))}loadFromStorage(){let t=this.authService.getUserStorageKey("expenses"),e=this.authService.getUserStorageKey("budgets"),s=this.authService.getUserStorageKey("savingsGoals"),a=this.authService.getUserStorageKey("salaries"),h=localStorage.getItem(t),n=localStorage.getItem(e),i=localStorage.getItem(s),u=localStorage.getItem(a);h&&(this.expenses=JSON.parse(h).map(o=>l(r({},o),{date:new Date(o.date)}))),n&&(this.budgets=JSON.parse(n)),i&&(this.savingsGoals=JSON.parse(i).map(o=>l(r({},o),{deadline:o.deadline?new Date(o.deadline):void 0}))),u&&(this.salaries=JSON.parse(u).map(o=>l(r({},o),{date:new Date(o.date)})))}static{this.\u0275fac=function(e){return new(e||g)(c(S))}}static{this.\u0275prov=d({token:g,factory:g.\u0275fac,providedIn:"root"})}}return g})();export{x as a};
