import{d as c}from"./chunk-MBI4MNMV.js";import{O as a,T as u,a as n,j as o}from"./chunk-X4VNRQJ7.js";var d=(()=>{class i{constructor(e){this.router=e,this.USERS_KEY="dailyfix_users",this.CURRENT_USER_KEY="dailyfix_current_user",this.currentUserSubject=new o(this.getCurrentUserFromStorage()),this.currentUser$=this.currentUserSubject.asObservable(),this.initializeDefaultUser()}initializeDefaultUser(){if(this.getUsers().length===0){let t={id:this.generateId(),fullName:"Alex Martin",email:"alex@example.com",password:"password123",createdAt:new Date().toISOString()};this.saveUser(t)}}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}getUsers(){let e=localStorage.getItem(this.USERS_KEY);return e?JSON.parse(e):[]}saveUsers(e){localStorage.setItem(this.USERS_KEY,JSON.stringify(e))}saveUser(e){let t=this.getUsers(),s=t.findIndex(r=>r.id===e.id);s>=0?t[s]=e:t.push(e),this.saveUsers(t)}getCurrentUserFromStorage(){let e=localStorage.getItem(this.CURRENT_USER_KEY);return e?JSON.parse(e):null}setCurrentUser(e){e?localStorage.setItem(this.CURRENT_USER_KEY,JSON.stringify(e)):localStorage.removeItem(this.CURRENT_USER_KEY),this.currentUserSubject.next(e)}signup(e){if(this.getUsers().find(l=>l.email.toLowerCase()===e.email.toLowerCase()))return{success:!1,error:"Cet email est d\xE9j\xE0 utilis\xE9"};let r={id:this.generateId(),fullName:e.fullName,email:e.email,password:e.password,createdAt:new Date().toISOString()};return this.saveUser(r),this.setCurrentUser(r),{success:!0}}login(e){let s=this.getUsers().find(r=>r.email.toLowerCase()===e.email.toLowerCase()&&r.password===e.password);return s?(this.setCurrentUser(s),{success:!0}):{success:!1,error:"Email ou mot de passe incorrect"}}logout(){this.setCurrentUser(null),this.router.navigate(["/login"])}getCurrentUser(){return this.currentUserSubject.value}isAuthenticated(){return this.getCurrentUser()!==null}updateUser(e){let t=this.getCurrentUser();if(!t)return;let s=n(n({},t),e);this.saveUser(s),this.setCurrentUser(s)}static{this.\u0275fac=function(t){return new(t||i)(u(c))}}static{this.\u0275prov=a({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();export{d as a};
