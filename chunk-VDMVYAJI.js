import{Sa as A,p as y}from"./chunk-AJ37PTJK.js";import{c as o}from"./chunk-POLL2CVR.js";var w="Tu es un assistant sant\xE9 int\xE9gr\xE9 \xE0 l'application DailyFix. Tu r\xE9ponds de fa\xE7on bienveillante et factuelle sur la nutrition, le sommeil, l'activit\xE9 physique, l'hydratation et la m\xE9ditation. Donne des conseils courts et pratiques. Ne pose pas de diagnostic m\xE9dical ; en cas de doute, recommande de consulter un professionnel de sant\xE9. R\xE9ponds dans la m\xEAme langue que l'utilisateur.",I="Tu es un assistant maison et cuisine int\xE9gr\xE9 \xE0 l'application DailyFix. Tu aides l'utilisateur pour : id\xE9es de repas \xE0 partir des ingr\xE9dients qu'il a, recettes simples, listes de courses, organisation du foyer, astuces m\xE9nage. Quand il donne une liste d'ingr\xE9dients, propose 1 \xE0 3 id\xE9es de plats ou recettes (entr\xE9e, plat, d\xEEner) avec des instructions courtes. Sois pratique et concis. R\xE9ponds toujours dans la m\xEAme langue que l'utilisateur.",K=(()=>{class a{constructor(){this.apiKey=A.geminiApiKey,this.dailyAdviceCache=null}isAvailable(){return!!this.apiKey&&this.apiKey.length>0}static{this.QUOTA_ERROR_KEY="health.discussionQuotaExceeded"}sendWithInstruction(t,i,l){return o(this,null,function*(){let c=()=>o(this,null,function*(){let{GoogleGenerativeAI:e}=yield import("./chunk-LJEOBI3R.js"),n=new e(this.apiKey).getGenerativeModel({model:"gemini-2.5-flash"}),u=i.map(m=>({role:m.role==="user"?"user":"model",parts:[{text:m.text}]})),g=(yield n.startChat({history:u,systemInstruction:{role:"user",parts:[{text:l}]}}).sendMessage(t)).response.text();return g==null||g===""?"D\xE9sol\xE9, je n'ai pas pu g\xE9n\xE9rer une r\xE9ponse. R\xE9essaie.":g}),r=e=>{let s=e&&typeof e=="object"&&"message"in e?String(e.message):"";return s.includes("429")||s.includes("quota")||s.includes("Quota exceeded")},d=e=>{let n=(e&&typeof e=="object"&&"message"in e?String(e.message):"").match(/[Pp]lease retry in ([\d.]+)s/);if(n){let u=parseFloat(n[1]);return Number.isFinite(u)?Math.ceil(u*1e3):6e3}return 6e3};try{return yield c()}catch(e){if(!r(e))throw e;let s=d(e);yield new Promise(n=>setTimeout(n,s));try{return yield c()}catch(n){throw r(n)?new Error(a.QUOTA_ERROR_KEY):n}}})}sendMessage(t,i){return o(this,null,function*(){if(!this.isAvailable())throw new Error("GEMINI_API_KEY is not configured. Add it in environment (geminiApiKey).");return this.sendWithInstruction(t,i,w)})}sendHouseholdMessage(t,i){return o(this,null,function*(){if(!this.isAvailable())throw new Error("GEMINI_API_KEY is not configured. Add it in environment (geminiApiKey).");return this.sendWithInstruction(t,i,I)})}getDailyAdvice(t,i){return o(this,null,function*(){if(!this.isAvailable())throw new Error("GEMINI_API_KEY is not configured.");let l=new Date().toDateString(),c=`${t.height??""}_${t.weight??""}_${t.gender??""}_${i}`;if(this.dailyAdviceCache&&this.dailyAdviceCache.dateKey===l&&this.dailyAdviceCache.profileKey===c)return this.dailyAdviceCache.text;let r=[];t.height!=null&&r.push(`taille ${t.height} cm`),t.weight!=null&&r.push(`poids ${t.weight} kg`),t.gender&&r.push(`genre ${t.gender}`);let d=i==="ar"?"arabe":i==="en"?"anglais":"fran\xE7ais",e=`Profil utilisateur : ${r.join(", ")||"non renseign\xE9"}. Donne exactement 2 ou 3 conseils sant\xE9 tr\xE8s courts et personnalis\xE9s pour la journ\xE9e (nutrition, eau, sommeil, activit\xE9). R\xE9ponds UNIQUEMENT dans la langue : ${d}. Pas de titre, pas de num\xE9rotation, juste des phrases courtes s\xE9par\xE9es par des retours \xE0 la ligne.`;try{let{GoogleGenerativeAI:s}=yield import("./chunk-LJEOBI3R.js"),h=(yield new s(this.apiKey).getGenerativeModel({model:"gemini-2.5-flash"}).generateContent(e)).response,p=(h?h.text():"").trim()||"Pas de conseil disponible.";return this.dailyAdviceCache={dateKey:l,profileKey:c,text:p},p}catch(s){let n=s&&typeof s=="object"&&"message"in s?String(s.message):"";throw n.includes("429")||n.includes("quota")||n.includes("Quota exceeded")?new Error(a.QUOTA_ERROR_KEY):s}})}static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275prov=y({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();export{K as a};
