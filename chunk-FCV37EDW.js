import{a as V,b as d,c as D,d as j,g as $,j as R,k as W,q as J,r as Y,s as K,u as Q}from"./chunk-OT6Q23XG.js";import{$ as z,C as I,D as E,E as y,Fa as N,Ja as T,M as n,N as C,Oa as U,Q as v,Qa as q,R as w,Ra as F,S as u,U as S,Ua as A,W as s,X as l,Y as b,Z as G,Za as H,_ as L,_a as X,aa as x,ba as M,c as P,d as O,ga as g,ha as c,ia as h,ra as B,ta as r,ua as a,y as k}from"./chunk-P62NHWZA.js";function Z(o,f){o&1&&(s(0,"div",31),g(1),r(2,"translate"),l()),o&2&&(n(),h(" ",a(2,1,"login.fullNameError")," "))}function ee(o,f){if(o&1&&(G(0),s(1,"label",28),g(2),r(3,"translate"),l(),b(4,"input",29),r(5,"translate"),v(6,Z,3,3,"div",30),L()),o&2){let e=M();n(2),c(a(3,3,"login.fullName")),n(2),u("placeholder",a(5,5,"login.fullNamePlaceholder")),n(2),u("ngIf",e.form.controls.fullName.touched&&e.form.controls.fullName.invalid)}}function ie(o,f){o&1&&(s(0,"div",32),g(1),r(2,"translate"),l()),o&2&&(n(),h(" ",a(2,1,"login.emailError")," "))}function te(o,f){o&1&&(s(0,"div",33),g(1),r(2,"translate"),l()),o&2&&(n(),h(" ",a(2,1,"login.passwordError")," "))}function ne(o,f){o&1&&(s(0,"p",34)(1,"a",35),g(2),r(3,"translate"),l()()),o&2&&(n(2),c(a(3,1,"login.forgotPassword")))}function oe(o,f){if(o&1&&(s(0,"div",36),g(1),l()),o&2){let e=M();n(),c(e.errorMessage)}}function re(o,f){if(o&1){let e=z();s(0,"button",37),x("click",function(){I(e);let i=M();return E(i.signupWithFacebook())}),y(),s(1,"svg",38),b(2,"path",39),l(),g(3),r(4,"translate"),l()}o&2&&(n(3),h(" ",a(4,1,"login.facebookSignup")," "))}var fe=(()=>{class o{constructor(e,t,i,m){this.formBuilder=e,this.router=t,this.route=i,this.authService=m,this.authMode="login",this.errorMessage="",this.isLoading=!1,this.googleClientId="248580902178-3s8374jnjcm4o3g0k2oi98md1sl9r7av.apps.googleusercontent.com",this.authSubscription=new O,this.form=this.formBuilder.group({email:["",[d.required,d.email]],password:["",[d.required,d.minLength(6)]]})}ngOnInit(){if(this.initializeGoogleSignIn(),this.authService.isAuthenticated()){let e=this.route.snapshot.queryParams.returnUrl||"/home";this.router.navigate([e])}}ngOnDestroy(){this.authSubscription&&this.authSubscription.unsubscribe()}initializeGoogleSignIn(){let e=setInterval(()=>{window.google&&(clearInterval(e),this.googleClientId&&window.google.accounts.id.initialize({client_id:this.googleClientId,callback:this.handleGoogleSignIn.bind(this),auto_select:!1,cancel_on_tap_outside:!0}))},100);setTimeout(()=>clearInterval(e),5e3)}switchMode(e){this.authMode!==e&&(this.authMode=e,this.errorMessage="",this.form=this.buildForm())}buildForm(){return this.authMode==="signup"?this.formBuilder.group({fullName:["",[d.required,d.minLength(2)]],email:["",[d.required,d.email]],password:["",[d.required,d.minLength(6)]]}):this.formBuilder.group({email:["",[d.required,d.email]],password:["",[d.required,d.minLength(6)]]})}submit(){if(this.form.invalid){this.form.markAllAsTouched();return}this.errorMessage="",this.isLoading=!0,this.authMode==="login"?this.authService.login({email:this.form.value.email,password:this.form.value.password}).subscribe({next:e=>{if(this.isLoading=!1,e.success){let t=this.route.snapshot.queryParams.returnUrl;t?this.router.navigate([t]):e.user&&e.user.role==="admin"?this.router.navigate(["/admin"]):this.router.navigate(["/home"])}else this.errorMessage=e.error||e.message||"Erreur de connexion"},error:e=>{this.isLoading=!1,this.errorMessage=e.message||"Erreur de connexion"}}):this.authService.signup({fullName:this.form.value.fullName,email:this.form.value.email,password:this.form.value.password}).subscribe({next:e=>{if(this.isLoading=!1,e.success){let t=this.route.snapshot.queryParams.returnUrl;t?this.router.navigate([t]):e.user&&e.user.role==="admin"?this.router.navigate(["/admin"]):this.router.navigate(["/home"])}else this.errorMessage=e.error||e.message||"Erreur lors de l'inscription"},error:e=>{this.isLoading=!1,this.errorMessage=e.message||"Erreur lors de l'inscription"}})}get isSignup(){return this.authMode==="signup"}signupWithGoogle(){if(this.errorMessage="",this.isLoading=!0,window.google&&this.googleClientId)try{window.google.accounts.id.prompt(e=>{(e.isNotDisplayed()||e.isSkippedMoment())&&this.useGoogleOAuth2()})}catch(e){console.error("Erreur Google One Tap:",e),this.useGoogleOAuth2()}else window.google&&!this.googleClientId?this.useGoogleOAuth2():this.simulateGoogleSignIn()}useGoogleOAuth2(){if(window.google)try{window.google.accounts.oauth2.initTokenClient({client_id:this.googleClientId||"YOUR_CLIENT_ID.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile",callback:t=>{t.access_token?this.getGoogleUserInfo(t.access_token):t.error&&(console.error("Erreur OAuth2:",t.error),this.isLoading=!1,this.errorMessage="Erreur lors de la connexion avec Google")}}).requestAccessToken()}catch(e){console.error("Erreur OAuth2:",e),this.simulateGoogleSignIn()}else this.simulateGoogleSignIn()}getGoogleUserInfo(e){return P(this,null,function*(){try{let t=yield fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${e}`}});if(!t.ok){let p=yield t.json().catch(()=>({}));throw new Error(p.error?.message||`HTTP ${t.status}: ${t.statusText}`)}let i=yield t.json();if(!i.email||!i.id)throw new Error("Informations utilisateur incompl\xE8tes depuis Google");let m={name:i.name||`${i.given_name||""} ${i.family_name||""}`.trim()||"Utilisateur Google",email:i.email,sub:i.id};this.authSubscription.add(this.authService.signupWithGoogle(m).subscribe({next:p=>{if(this.isLoading=!1,p.success){let _=this.route.snapshot.queryParams.returnUrl;_?this.router.navigate([_]):p.user&&p.user.role==="admin"?this.router.navigate(["/admin"]):this.router.navigate(["/home"])}else this.errorMessage=p.message||"Erreur lors de l'inscription avec Google"},error:p=>{console.error("Erreur lors de la connexion avec Google:",p),this.isLoading=!1,this.errorMessage=p.message||"Erreur lors de la connexion avec Google"}}))}catch(t){console.error("Erreur lors de la r\xE9cup\xE9ration des infos Google:",t),this.isLoading=!1,this.errorMessage=t.message||"Erreur lors de la connexion avec Google"}})}handleGoogleSignIn(e){try{if(!e.credential)throw new Error("R\xE9ponse Google invalide: credential manquant");let t=e.credential.split(".");if(t.length!==3)throw new Error("Format de credential Google invalide");let i=JSON.parse(atob(t[1]));if(!i.email||!i.sub)throw new Error("Informations utilisateur incompl\xE8tes dans le token Google");let m={name:i.name||`${i.given_name||""} ${i.family_name||""}`.trim()||"Utilisateur Google",email:i.email,sub:i.sub};this.authSubscription.add(this.authService.signupWithGoogle(m).subscribe({next:p=>{if(this.isLoading=!1,p.success){let _=this.route.snapshot.queryParams.returnUrl;_?this.router.navigate([_]):p.user&&p.user.role==="admin"?this.router.navigate(["/admin"]):this.router.navigate(["/home"])}else this.errorMessage=p.message||"Erreur lors de l'inscription avec Google"},error:p=>{console.error("Erreur lors de la connexion Google:",p),this.isLoading=!1,this.errorMessage=p.message||"Erreur lors de la connexion avec Google"}}))}catch(t){console.error("Erreur lors de la connexion Google:",t),this.isLoading=!1,this.errorMessage=t.message||"Erreur lors de la connexion avec Google"}}simulateGoogleSignIn(){setTimeout(()=>{let e={name:"Utilisateur Google",email:`google.user.${Date.now()}@gmail.com`,sub:`google_${Date.now()}`};this.authService.signupWithGoogle(e).subscribe({next:t=>{if(this.isLoading=!1,t.success){let i=this.route.snapshot.queryParams.returnUrl;i?this.router.navigate([i]):t.user&&t.user.role==="admin"?this.router.navigate(["/admin"]):this.router.navigate(["/home"])}else this.errorMessage=t.error||t.message||"Erreur lors de l'inscription avec Google"},error:t=>{this.isLoading=!1,this.errorMessage=t.message||"Erreur lors de l'inscription avec Google"}})},1e3)}signupWithFacebook(){console.log("Signup with Facebook")}static{this.\u0275fac=function(t){return new(t||o)(C(K),C(q),C(U),C(H))}}static{this.\u0275cmp=k({type:o,selectors:[["app-login"]],standalone:!0,features:[B],decls:57,vars:59,consts:[[1,"auth-page"],[1,"brand"],[1,"subtitle"],[1,"card"],[1,"title"],[1,"subtext"],["role","tablist","aria-label","Mode d'authentification",1,"tabs"],["type","button",1,"tab",3,"click"],["novalidate","",3,"ngSubmit","formGroup"],[4,"ngIf"],["for","email"],["id","email","type","email","formControlName","email","autocomplete","email","required","","aria-describedby","emailHelp",3,"placeholder"],["id","emailHelp","class","error",4,"ngIf"],["for","password"],["id","password","type","password","formControlName","password","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022","autocomplete","current-password","required","","minlength","6","aria-describedby","passwordHelp"],["id","passwordHelp","class","error",4,"ngIf"],["class","forgot-link",4,"ngIf"],["class","error-message",4,"ngIf"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"social-auth"],[1,"divider"],["type","button",1,"social","google",3,"click"],["viewBox","0 0 48 48","aria-hidden","true"],["fill","#FFC107","d","M43.611 20.083H42V20H24v8h11.303C33.642 32.324 29.223 36 24 36c-6.627 0-12-5.373-12-12s5.373-12 12-12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.869 6.053 29.706 4 24 4 12.955 4 4 12.955 4 24s8.955 20 20 20 20-8.955 20-20c0-1.341-.138-2.651-.389-3.917z"],["fill","#FF3D00","d","M6.306 14.691l6.571 4.818C14.264 16.106 18.74 12 24 12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.869 6.053 29.706 4 24 4 16.318 4 9.656 8.337 6.306 14.691z"],["fill","#4CAF50","d","M24 44c5.166 0 9.86-1.977 13.409-5.193l-6.199-5.238C29.155 35.091 26.715 36 24 36c-5.202 0-9.61-3.654-11.289-8.568l-6.548 5.046C9.458 39.556 16.138 44 24 44z"],["fill","#1976D2","d","M43.611 20.083H42V20H24v8h11.303c-1.361 3.324-5.78 7-11.303 7-6.627 0-12-5.373-12-12s5.373-12 12-12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.869 6.053 29.706 4 24 4 12.955 4 4 12.955 4 24s8.955 20 20 20 20-8.955 20-20c0-1.341-.138-2.651-.389-3.917z"],["type","button","class","social facebook",3,"click",4,"ngIf"],["for","fullName"],["id","fullName","type","text","formControlName","fullName","autocomplete","name","required","","aria-describedby","fullNameHelp",3,"placeholder"],["id","fullNameHelp","class","error",4,"ngIf"],["id","fullNameHelp",1,"error"],["id","emailHelp",1,"error"],["id","passwordHelp",1,"error"],[1,"forgot-link"],["routerLink","/forgot-password"],[1,"error-message"],["type","button",1,"social","facebook",3,"click"],["viewBox","0 0 24 24","aria-hidden","true"],["fill","#1877F2","d","M24 12.073C24 5.405 18.627 0 12 0S0 5.405 0 12.073C0 18.095 4.388 23.093 10.125 24v-8.437H7.078V12.07h3.047V9.412c0-3.007 1.792-4.668 4.533-4.668 1.312 0 2.686.235 2.686.235v2.953h-1.514c-1.491 0-1.953.926-1.953 1.874v2.264h3.328l-.532 3.492h-2.796V24C19.612 23.093 24 18.095 24 12.073z"]],template:function(t,i){t&1&&(s(0,"div",0)(1,"h1",1),g(2),r(3,"translate"),l(),s(4,"p",2),g(5),r(6,"translate"),l(),s(7,"section",3),r(8,"translate"),s(9,"h2",4),g(10),r(11,"translate"),l(),s(12,"p",5),g(13),r(14,"translate"),l(),s(15,"div",6)(16,"button",7),x("click",function(){return i.switchMode("login")}),g(17),r(18,"translate"),l(),s(19,"button",7),x("click",function(){return i.switchMode("signup")}),g(20),r(21,"translate"),l()(),s(22,"form",8),x("ngSubmit",function(){return i.submit()}),v(23,ee,7,7,"ng-container",9),s(24,"label",10),g(25),r(26,"translate"),l(),b(27,"input",11),r(28,"translate"),v(29,ie,3,3,"div",12),s(30,"label",13),g(31),r(32,"translate"),l(),b(33,"input",14),v(34,te,3,3,"div",15)(35,ne,4,3,"p",16)(36,oe,2,1,"div",17),s(37,"button",18),g(38),r(39,"translate"),r(40,"translate"),r(41,"translate"),l()(),s(42,"div",19)(43,"div",20)(44,"span"),g(45),r(46,"translate"),l()(),s(47,"button",21),x("click",function(){return i.signupWithGoogle()}),y(),s(48,"svg",22),b(49,"path",23)(50,"path",24)(51,"path",25)(52,"path",26),l(),g(53),r(54,"translate"),r(55,"translate"),l(),v(56,re,5,3,"button",27),l()()()),t&2&&(n(2),c(a(3,27,"login.brand")),n(3),c(a(6,29,"login.subtitle")),n(2),w("aria-label",a(8,31,"login.login")),n(3),c(a(11,33,"login.welcome")),n(3),c(a(14,35,"login.welcomeDesc")),n(3),S("active",!i.isSignup),w("aria-selected",!i.isSignup),n(),c(a(18,37,"login.login")),n(2),S("active",i.isSignup),w("aria-selected",i.isSignup),n(),c(a(21,39,"login.signup")),n(2),u("formGroup",i.form),n(),u("ngIf",i.isSignup),n(2),c(a(26,41,"login.email")),n(2),u("placeholder",a(28,43,"login.emailPlaceholder")),n(2),u("ngIf",i.form.controls.email.touched&&i.form.controls.email.invalid),n(2),c(a(32,45,"login.password")),n(3),u("ngIf",i.form.controls.password.touched&&i.form.controls.password.invalid),n(),u("ngIf",!i.isSignup),n(),u("ngIf",i.errorMessage),n(),u("disabled",i.isLoading),n(),h(" ",i.isLoading?a(39,47,"common.loading"):i.isSignup?a(40,49,"login.submitSignup"):a(41,51,"login.submitLogin")," "),n(7),c(a(46,53,"common.or")),n(8),h(" ",i.isSignup?a(54,55,"login.googleSignup"):a(55,57,"login.googleLogin")," "),n(3),u("ngIf",i.isSignup))},dependencies:[T,N,Q,$,V,D,j,J,Y,R,W,A,F,X],styles:['[_nghost-%COMP%]{display:block}.auth-page[_ngcontent-%COMP%]{min-height:100vh;width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:var(--notion-spacing-2xl) var(--notion-spacing-lg);background:var(--notion-bg-secondary);font-family:ui-sans-serif,-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif;overflow-x:hidden;box-sizing:border-box}.brand[_ngcontent-%COMP%]{font-size:40px;font-weight:700;color:var(--notion-text-primary);margin:0 0 8px;text-align:center;letter-spacing:-.03em}.subtitle[_ngcontent-%COMP%]{color:var(--notion-text-secondary);margin:0 0 var(--notion-spacing-2xl) 0;text-align:center;font-size:14px}.card[_ngcontent-%COMP%]{width:100%;max-width:400px;background:var(--notion-bg);border:1px solid var(--notion-border);border-radius:var(--notion-radius);box-shadow:var(--notion-shadow);padding:var(--notion-spacing-xl)}.title[_ngcontent-%COMP%]{text-align:center;font-size:24px;margin:0 0 4px;color:var(--notion-text-primary);font-weight:600;letter-spacing:-.02em}.subtext[_ngcontent-%COMP%]{text-align:center;color:var(--notion-text-tertiary);margin:0 0 var(--notion-spacing-lg);font-size:14px}.tabs[_ngcontent-%COMP%]{display:flex;align-items:center;gap:0;background:var(--notion-bg-tertiary);padding:2px;border-radius:var(--notion-radius);margin:0 auto var(--notion-spacing-lg);width:100%;max-width:300px;border:1px solid var(--notion-border)}.tab[_ngcontent-%COMP%]{flex:1 1 0;border:none;background:transparent;color:var(--notion-text-secondary);font-weight:400;padding:6px 12px;border-radius:var(--notion-radius-sm);cursor:pointer;transition:all 20ms ease-in 0s;font-size:14px}.tab[_ngcontent-%COMP%]:hover{background:#00000008}.tab.active[_ngcontent-%COMP%]{background:var(--notion-bg);color:var(--notion-text-primary);font-weight:500;box-shadow:var(--notion-shadow-sm)}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--notion-spacing-lg)}label[_ngcontent-%COMP%]{font-size:12px;color:var(--notion-text-secondary);font-weight:500;margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px}input[_ngcontent-%COMP%]{width:100%;padding:6px 8px;border-radius:var(--notion-radius);border:1px solid var(--notion-border);background:var(--notion-bg);font-size:14px;outline:none;transition:border-color 20ms ease-in 0s;font-family:inherit}input[_ngcontent-%COMP%]:focus{border-color:var(--notion-blue);box-shadow:0 0 0 1px var(--notion-blue)}.error[_ngcontent-%COMP%]{color:var(--notion-red);font-size:12px;margin-top:-12px;font-weight:400}.submit[_ngcontent-%COMP%]{margin-top:0;width:100%;padding:8px 12px;border-radius:var(--notion-radius);border:none;background:var(--notion-text-primary);color:#fff;font-weight:500;font-size:14px;cursor:pointer;transition:background 20ms ease-in 0s}.dark-theme[_ngcontent-%COMP%]   .submit[_ngcontent-%COMP%]{background:#ffffff14!important;border:1px solid rgba(255,255,255,.2)!important;color:var(--notion-text-primary)!important}.dark-theme[_ngcontent-%COMP%]   .submit[_ngcontent-%COMP%]:hover{background:#ffffff26!important;border-color:#ffffff4d!important}.submit[_ngcontent-%COMP%]:hover{background:#2e2e2c}.submit[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.submit[_ngcontent-%COMP%]:disabled:hover{background:var(--notion-text-primary)}.forgot-link[_ngcontent-%COMP%]{margin:-8px 0 0;font-size:13px;text-align:right}.forgot-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--notion-blue);text-decoration:none}.forgot-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.error-message[_ngcontent-%COMP%]{color:var(--notion-red);font-size:13px;margin-top:-8px;margin-bottom:8px;text-align:center;padding:8px;background:var(--notion-red-bg);border-radius:var(--notion-radius);border:1px solid var(--notion-red)}.social-auth[_ngcontent-%COMP%]{margin-top:var(--notion-spacing-lg);display:flex;flex-direction:column;gap:var(--notion-spacing)}.divider[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--notion-spacing);color:var(--notion-text-tertiary);font-size:12px;margin:var(--notion-spacing-lg) 0}.divider[_ngcontent-%COMP%]:before, .divider[_ngcontent-%COMP%]:after{content:"";height:1px;flex:1 1 0;background:var(--notion-border)}.social[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:var(--notion-spacing);width:100%;padding:8px 12px;border-radius:var(--notion-radius);border:1px solid var(--notion-border);background:var(--notion-bg);color:var(--notion-text-primary);font-weight:400;cursor:pointer;transition:background 20ms ease-in 0s;font-size:14px;font-family:inherit}.social[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:18px;height:18px}.social[_ngcontent-%COMP%]:hover{background:var(--notion-bg-hover)}.social.google[_ngcontent-%COMP%], .social.facebook[_ngcontent-%COMP%]{border-color:var(--notion-border)}@media (max-width: 768px){.auth-page[_ngcontent-%COMP%]{padding:var(--notion-spacing-xl) var(--notion-spacing)}.brand[_ngcontent-%COMP%]{font-size:32px}.subtitle[_ngcontent-%COMP%]{font-size:13px}.card[_ngcontent-%COMP%]{max-width:100%;padding:var(--notion-spacing-lg)}.title[_ngcontent-%COMP%]{font-size:20px}.tabs[_ngcontent-%COMP%]{max-width:100%}.social[_ngcontent-%COMP%]{padding:10px 12px;font-size:13px}.social[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:16px;height:16px}}@media (max-width: 480px){.auth-page[_ngcontent-%COMP%]{padding:var(--notion-spacing-lg) var(--notion-spacing-sm)}.brand[_ngcontent-%COMP%]{font-size:28px}.card[_ngcontent-%COMP%]{padding:var(--notion-spacing)}.title[_ngcontent-%COMP%]{font-size:18px}.subtext[_ngcontent-%COMP%]{font-size:13px}form[_ngcontent-%COMP%]{gap:var(--notion-spacing)}input[_ngcontent-%COMP%]{padding:8px 10px;font-size:13px}.submit[_ngcontent-%COMP%]{padding:10px 12px;font-size:13px}.social[_ngcontent-%COMP%]{padding:8px 10px;font-size:12px}}']})}}return o})();export{fe as LoginComponent};
