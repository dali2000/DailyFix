import{Pa as S,Qa as u,a as n,b as d,j as a,n as c,p as r,s as p,v as l}from"./chunk-2PZ7RXZT.js";var D=(()=>{class h{constructor(t,e){this.authService=t,this.apiService=e,this.meals=[],this.activities=[],this.sleepRecords=[],this.waterIntakes=[],this.meditationSessions=[],this.authService.currentUser$.pipe(c()).subscribe(i=>{i!==null?this.loadAll():(this.meals=[],this.activities=[],this.sleepRecords=[],this.waterIntakes=[],this.meditationSessions=[])})}getMeals(){return[...this.meals]}getMealsObservable(){return this.apiService.get("/health/meals").pipe(a(t=>t.data||[]),r(t=>this.meals=t.map(e=>d(n({},e),{id:e.id.toString(),date:new Date(e.date)}))))}addMeal(t){return this.apiService.post("/health/meals",t).pipe(a(e=>e.data),r(e=>{this.meals.push(d(n({},e),{id:e.id.toString(),date:new Date(e.date)}))}))}updateMeal(t,e){return this.apiService.put(`/health/meals/${t}`,e).pipe(a(i=>i.data),r(i=>{let s=this.meals.findIndex(o=>o.id===t);s!==-1&&(this.meals[s]=d(n({},i),{id:i.id.toString(),date:new Date(i.date)}))}))}deleteMeal(t){return this.apiService.delete(`/health/meals/${t}`).pipe(a(e=>e.success),r(()=>{let e=this.meals.findIndex(i=>i.id===t);e!==-1&&this.meals.splice(e,1)}))}getMealsForDate(t){let e=t.toDateString();return this.meals.filter(i=>new Date(i.date).toDateString()===e)}getTodayCalories(){let t=new Date;return this.getMealsForDate(t).reduce((e,i)=>e+(i.calories||0),0)}getActivities(){return[...this.activities]}getActivitiesObservable(){return this.apiService.get("/health/activities").pipe(a(t=>t.data||[]),r(t=>this.activities=t.map(e=>d(n({},e),{id:e.id.toString(),date:new Date(e.date)}))))}addActivity(t){return this.apiService.post("/health/activities",t).pipe(a(e=>e.data),r(e=>{this.activities.push(d(n({},e),{id:e.id.toString(),date:new Date(e.date)}))}))}updateActivity(t,e){return this.apiService.put(`/health/activities/${t}`,e).pipe(a(i=>i.data),r(i=>{let s=this.activities.findIndex(o=>o.id===t);s!==-1&&(this.activities[s]=d(n({},i),{id:i.id.toString(),date:new Date(i.date)}))}))}deleteActivity(t){return this.apiService.delete(`/health/activities/${t}`).pipe(a(e=>e.success),r(()=>{let e=this.activities.findIndex(i=>i.id===t);e!==-1&&this.activities.splice(e,1)}))}getActivitiesForDate(t){let e=t.toDateString();return this.activities.filter(i=>new Date(i.date).toDateString()===e)}getTodayActivityMinutes(){let t=new Date;return this.getActivitiesForDate(t).reduce((e,i)=>e+i.duration,0)}getSleepRecords(){return[...this.sleepRecords]}getSleepRecordsObservable(){return this.apiService.get("/health/sleep").pipe(a(t=>t.data||[]),r(t=>this.sleepRecords=t.map(e=>d(n({},e),{id:e.id.toString(),date:new Date(e.date),sleepTime:new Date(e.sleepTime),wakeTime:new Date(e.wakeTime)}))))}addSleepRecord(t){let e=(new Date(t.wakeTime).getTime()-new Date(t.sleepTime).getTime())/36e5,i=d(n({},t),{hours:Math.round(e*10)/10});return this.apiService.post("/health/sleep",i).pipe(a(s=>s.data),r(s=>{this.sleepRecords.push(d(n({},s),{id:s.id.toString(),date:new Date(s.date),sleepTime:new Date(s.sleepTime),wakeTime:new Date(s.wakeTime)}))}))}updateSleepRecord(t,e){return this.apiService.put(`/health/sleep/${t}`,e).pipe(a(i=>i.data),r(i=>{let s=this.sleepRecords.findIndex(o=>o.id===t);s!==-1&&(this.sleepRecords[s]=d(n({},i),{id:i.id.toString(),date:new Date(i.date),sleepTime:new Date(i.sleepTime),wakeTime:new Date(i.wakeTime)}))}))}deleteSleepRecord(t){return this.apiService.delete(`/health/sleep/${t}`).pipe(a(e=>e.success),r(()=>{let e=this.sleepRecords.findIndex(i=>i.id===t);e!==-1&&this.sleepRecords.splice(e,1)}))}getLastSleepRecord(){return this.sleepRecords.length>0?this.sleepRecords.sort((t,e)=>new Date(e.date).getTime()-new Date(t.date).getTime())[0]:void 0}getWaterIntakes(){return[...this.waterIntakes]}getWaterIntakesObservable(){return this.apiService.get("/health/water").pipe(a(t=>t.data||[]),r(t=>this.waterIntakes=t.map(e=>d(n({},e),{id:e.id.toString(),date:new Date(e.date)}))))}addWaterIntake(t){return this.apiService.post("/health/water",t).pipe(a(e=>e.data),r(e=>{this.waterIntakes.push(d(n({},e),{id:e.id.toString(),date:new Date(e.date)}))}))}updateWaterIntake(t,e){return this.apiService.put(`/health/water/${t}`,e).pipe(a(i=>i.data),r(i=>{let s=this.waterIntakes.findIndex(o=>o.id===t);s!==-1&&(this.waterIntakes[s]=d(n({},i),{id:i.id.toString(),date:new Date(i.date)}))}))}deleteWaterIntake(t){return this.apiService.delete(`/health/water/${t}`).pipe(a(e=>e.success),r(()=>{let e=this.waterIntakes.findIndex(i=>i.id===t);e!==-1&&this.waterIntakes.splice(e,1)}))}getTodayWaterIntake(){let e=new Date().toDateString();return this.waterIntakes.filter(i=>new Date(i.date).toDateString()===e).reduce((i,s)=>i+s.amount,0)}getMeditationSessions(){return[...this.meditationSessions]}getMeditationSessionsObservable(){return this.apiService.get("/health/meditation").pipe(a(t=>t.data||[]),r(t=>this.meditationSessions=t.map(e=>d(n({},e),{id:e.id.toString(),date:new Date(e.date)}))))}addMeditationSession(t){return this.apiService.post("/health/meditation",t).pipe(a(e=>e.data),r(e=>{this.meditationSessions.push(d(n({},e),{id:e.id.toString(),date:new Date(e.date)}))}))}updateMeditationSession(t,e){return this.apiService.put(`/health/meditation/${t}`,e).pipe(a(i=>i.data),r(i=>{let s=this.meditationSessions.findIndex(o=>o.id===t);s!==-1&&(this.meditationSessions[s]=d(n({},i),{id:i.id.toString(),date:new Date(i.date)}))}))}deleteMeditationSession(t){return this.apiService.delete(`/health/meditation/${t}`).pipe(a(e=>e.success),r(()=>{let e=this.meditationSessions.findIndex(i=>i.id===t);e!==-1&&this.meditationSessions.splice(e,1)}))}loadAll(){this.authService.isAuthenticated()?(this.getMealsObservable().subscribe({error:t=>console.error("Error loading meals:",t)}),this.getActivitiesObservable().subscribe({error:t=>console.error("Error loading activities:",t)}),this.getSleepRecordsObservable().subscribe({error:t=>console.error("Error loading sleep records:",t)}),this.getWaterIntakesObservable().subscribe({error:t=>console.error("Error loading water intakes:",t)}),this.getMeditationSessionsObservable().subscribe({error:t=>console.error("Error loading meditation sessions:",t)})):(this.meals=[],this.activities=[],this.sleepRecords=[],this.waterIntakes=[],this.meditationSessions=[])}static{this.\u0275fac=function(e){return new(e||h)(l(u),l(S))}}static{this.\u0275prov=p({token:h,factory:h.\u0275fac,providedIn:"root"})}}return h})();export{D as a};
