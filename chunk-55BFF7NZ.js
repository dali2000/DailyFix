import{Ta as S,Xa as v,g as r,k as m,m as o,p as x,s as f}from"./chunk-AJ37PTJK.js";import{a as d,b as u}from"./chunk-POLL2CVR.js";var D=(()=>{class p{parseAmount(t){if(t==null)return 0;if(typeof t=="number"&&!Number.isNaN(t))return t;let e=String(t).trim().replace(",","."),s=parseFloat(e);return Number.isNaN(s)?0:s}constructor(t,e){this.authService=t,this.apiService=e,this.expenses=[],this.budgets=[],this.savingsGoals=[],this.salaries=[],this.authService.currentUser$.pipe(m()).subscribe(s=>{s!==null?this.loadAll():(this.expenses=[],this.budgets=[],this.savingsGoals=[],this.salaries=[])})}getExpenses(){return[...this.expenses]}getExpensesObservable(){return this.apiService.get("/finance/expenses").pipe(r(t=>t.data||[]),o(t=>this.expenses=t.map(e=>u(d({},e),{id:e.id.toString(),date:new Date(e.date),amount:this.parseAmount(e.amount)}))))}addExpense(t){return this.apiService.post("/finance/expenses",t).pipe(r(e=>e.data),o(e=>{this.expenses.push(u(d({},e),{id:e.id.toString(),date:new Date(e.date)}))}))}updateExpense(t,e){return this.apiService.put(`/finance/expenses/${t}`,e).pipe(r(s=>s.data),o(s=>{let n=this.expenses.findIndex(l=>l.id===t);n!==-1&&(this.expenses[n]=u(d({},s),{id:s.id.toString(),date:new Date(s.date)}))}))}deleteExpense(t){return this.apiService.delete(`/finance/expenses/${t}`).pipe(r(e=>e.success),o(()=>{let e=this.expenses.findIndex(s=>s.id===t);e!==-1&&this.expenses.splice(e,1)}))}getTotalExpenses(){return this.expenses.reduce((t,e)=>t+this.parseAmount(e.amount),0)}getExpensesByCategory(t){return this.expenses.filter(e=>e.category===t)}getBudgets(){return[...this.budgets]}getBudgetsObservable(){return this.apiService.get("/finance/budgets").pipe(r(t=>t.data||[]),o(t=>this.budgets=t.map(e=>u(d({},e),{id:e.id.toString(),limit:this.parseAmount(e.limit),spent:this.parseAmount(e.spent)}))))}addBudget(t){return this.apiService.post("/finance/budgets",t).pipe(r(e=>e.data),o(e=>{this.budgets.push(u(d({},e),{id:e.id.toString()}))}))}updateBudget(t,e){return this.apiService.put(`/finance/budgets/${t}`,e).pipe(r(s=>s.data),o(s=>{let n=this.budgets.findIndex(l=>l.id===t);n!==-1&&(this.budgets[n]=u(d({},s),{id:s.id.toString()}))}))}deleteBudget(t){return this.apiService.delete(`/finance/budgets/${t}`).pipe(r(e=>e.success),o(()=>{let e=this.budgets.findIndex(s=>s.id===t);e!==-1&&this.budgets.splice(e,1)}))}getSavingsGoals(){return[...this.savingsGoals]}getSavingsGoalsObservable(){return this.apiService.get("/finance/savings-goals").pipe(r(t=>t.data||[]),o(t=>this.savingsGoals=t.map(e=>u(d({},e),{id:e.id.toString(),deadline:e.deadline?new Date(e.deadline):void 0,targetAmount:this.parseAmount(e.targetAmount),currentAmount:this.parseAmount(e.currentAmount)}))))}updateSavingsGoal(t,e){return this.apiService.put(`/finance/savings-goals/${t}`,e).pipe(r(s=>s.data),o(s=>{let n=this.savingsGoals.findIndex(l=>l.id===t);n!==-1&&(this.savingsGoals[n]=u(d({},s),{id:s.id.toString(),deadline:s.deadline?new Date(s.deadline):void 0}))}))}deleteSavingsGoal(t){return this.apiService.delete(`/finance/savings-goals/${t}`).pipe(r(e=>e.success),o(()=>{let e=this.savingsGoals.findIndex(s=>s.id===t);e!==-1&&this.savingsGoals.splice(e,1)}))}getSalaries(){return[...this.salaries]}getSalariesObservable(){return this.apiService.get("/finance/salaries").pipe(r(t=>t.data||[]),o(t=>this.salaries=t.map(e=>u(d({},e),{id:e.id.toString(),date:new Date(e.date),amount:this.parseAmount(e.amount)}))))}addSalary(t){return this.apiService.post("/finance/salaries",t).pipe(r(e=>e.data),o(e=>{this.salaries.push(u(d({},e),{id:e.id.toString(),date:new Date(e.date)}))}))}updateSalary(t,e){return this.apiService.put(`/finance/salaries/${t}`,e).pipe(r(s=>s.data),o(s=>{let n=this.salaries.findIndex(l=>l.id===t);n!==-1&&(this.salaries[n]=u(d({},s),{id:s.id.toString(),date:new Date(s.date)}))}))}deleteSalary(t){return this.apiService.delete(`/finance/salaries/${t}`).pipe(r(e=>e.success),o(()=>{let e=this.salaries.findIndex(s=>s.id===t);e!==-1&&this.salaries.splice(e,1)}))}getTotalIncome(){return this.salaries.reduce((t,e)=>t+e.amount,0)}getTotalExpensesForMonth(t,e){return this.expenses.filter(s=>{let n=new Date(s.date);return n.getFullYear()===t&&n.getMonth()===e}).reduce((s,n)=>s+this.parseAmount(n.amount),0)}getMonthlySalary(){let t=new Date;return this.getSalaryForMonth(t.getFullYear(),t.getMonth())}getSalaryForMonth(t,e){let n=this.salaries.filter(i=>{let a=new Date(i.date);return i.period==="monthly"&&a.getFullYear()===t&&a.getMonth()===e}).reduce((i,a)=>i+this.parseAmount(a.amount),0),h=this.salaries.filter(i=>{let a=new Date(i.date);return i.period==="yearly"&&a.getFullYear()===t}).reduce((i,a)=>i+this.parseAmount(a.amount)/12,0);return n+h}getSalariesForMonth(t,e){return this.salaries.filter(s=>{let n=new Date(s.date);return s.period==="monthly"?n.getFullYear()===t&&n.getMonth()===e:s.period==="yearly"&&n.getFullYear()===t})}getMonthlyBudget(){return this.budgets.filter(e=>e.period==="monthly").reduce((e,s)=>e+this.parseAmount(s.limit),0)}getRemainingBudget(t,e){let s=t!==void 0&&e!==void 0?{year:t,month:e}:{year:new Date().getFullYear(),month:new Date().getMonth()},n=this.getTotalExpensesForMonth(s.year,s.month);return this.getMonthlyBudget()-n}getCumulativeBalanceBeforeMonth(t,e){let s=0,n=new Set;this.salaries.forEach(h=>{let i=new Date(h.date),a=`${i.getFullYear()}-${i.getMonth()}`;(i.getFullYear()<t||i.getFullYear()===t&&i.getMonth()<e)&&n.add(a)}),this.expenses.forEach(h=>{let i=new Date(h.date),a=`${i.getFullYear()}-${i.getMonth()}`;(i.getFullYear()<t||i.getFullYear()===t&&i.getMonth()<e)&&n.add(a)});let l=Array.from(n).sort();for(let h of l){let[i,a]=h.split("-").map(Number),c=this.getSalaryForMonth(i,a),g=this.getTotalExpensesForMonth(i,a);s+=c-g}return s}getRemainingBalance(t,e){let s=t!==void 0&&e!==void 0?{year:t,month:e}:{year:new Date().getFullYear(),month:new Date().getMonth()},n=this.getCumulativeBalanceBeforeMonth(s.year,s.month),l=this.getSalaryForMonth(s.year,s.month),h=this.getTotalExpensesForMonth(s.year,s.month);return n+l-h}getSavingsSuggestions(t,e){let s=[],n=t!==void 0&&e!==void 0?{year:t,month:e}:{year:new Date().getFullYear(),month:new Date().getMonth()},l=this.getTotalExpensesForMonth(n.year,n.month),h=this.expenses.filter(i=>{let a=new Date(i.date);return a.getFullYear()===n.year&&a.getMonth()===n.month});return l>0&&(h.filter(c=>c.category==="food").reduce((c,g)=>c+this.parseAmount(g.amount),0)>l*.3&&s.push("Consid\xE9rez r\xE9duire les d\xE9penses alimentaires en cuisinant plus \xE0 la maison"),h.filter(c=>c.category==="leisure").reduce((c,g)=>c+this.parseAmount(g.amount),0)>l*.2&&s.push("R\xE9duisez les d\xE9penses de loisirs en cherchant des activit\xE9s gratuites")),s}getExpensesForMonth(t,e){return this.expenses.filter(s=>{let n=new Date(s.date);return n.getFullYear()===t&&n.getMonth()===e})}addSavingsGoal(t){let e="currentAmount"in t?u(d({},t),{currentAmount:t.currentAmount||0}):u(d({},t),{currentAmount:0});return this.apiService.post("/finance/savings-goals",e).pipe(r(s=>s.data),o(s=>{this.savingsGoals.push(u(d({},s),{id:s.id.toString(),deadline:s.deadline?new Date(s.deadline):void 0}))}))}loadAll(){this.authService.isAuthenticated()?(this.getExpensesObservable().subscribe({error:t=>console.error("Error loading expenses:",t)}),this.getBudgetsObservable().subscribe({error:t=>console.error("Error loading budgets:",t)}),this.getSavingsGoalsObservable().subscribe({error:t=>console.error("Error loading savings goals:",t)}),this.getSalariesObservable().subscribe({error:t=>console.error("Error loading salaries:",t)})):(this.expenses=[],this.budgets=[],this.savingsGoals=[],this.salaries=[])}static{this.\u0275fac=function(e){return new(e||p)(f(v),f(S))}}static{this.\u0275prov=x({token:p,factory:p.\u0275fac,providedIn:"root"})}}return p})();export{D as a};
