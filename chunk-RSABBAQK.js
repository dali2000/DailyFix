import{Sa as h,p as m}from"./chunk-ZZFONNLE.js";import{c as l}from"./chunk-POLL2CVR.js";var f="Tu es un assistant sant\xE9 int\xE9gr\xE9 \xE0 l'application DailyFix. Tu r\xE9ponds de fa\xE7on bienveillante et factuelle sur la nutrition, le sommeil, l'activit\xE9 physique, l'hydratation et la m\xE9ditation. Donne des conseils courts et pratiques. Ne pose pas de diagnostic m\xE9dical ; en cas de doute, recommande de consulter un professionnel de sant\xE9. R\xE9ponds dans la m\xEAme langue que l'utilisateur.",I=(()=>{class i{constructor(){this.apiKey=h.geminiApiKey}isAvailable(){return!!this.apiKey&&this.apiKey.length>0}static{this.QUOTA_ERROR_KEY="health.discussionQuotaExceeded"}sendMessage(n,o){return l(this,null,function*(){if(!this.isAvailable())throw new Error("GEMINI_API_KEY is not configured. Add it in environment (geminiApiKey).");let a=()=>l(this,null,function*(){let{GoogleGenerativeAI:e}=yield import("./chunk-LJEOBI3R.js"),s=new e(this.apiKey).getGenerativeModel({model:"gemini-2.5-flash"}),r=o.map(g=>({role:g.role==="user"?"user":"model",parts:[{text:g.text}]})),p=(yield s.startChat({history:r,systemInstruction:{role:"user",parts:[{text:f}]}}).sendMessage(n)).response.text();return p==null||p===""?"D\xE9sol\xE9, je n'ai pas pu g\xE9n\xE9rer une r\xE9ponse. R\xE9essaie.":p}),c=e=>{let t=e&&typeof e=="object"&&"message"in e?String(e.message):"";return t.includes("429")||t.includes("quota")||t.includes("Quota exceeded")},u=e=>{let s=(e&&typeof e=="object"&&"message"in e?String(e.message):"").match(/[Pp]lease retry in ([\d.]+)s/);if(s){let r=parseFloat(s[1]);return Number.isFinite(r)?Math.ceil(r*1e3):6e3}return 6e3};try{return yield a()}catch(e){if(!c(e))throw e;let t=u(e);yield new Promise(s=>setTimeout(s,t));try{return yield a()}catch(s){throw c(s)?new Error(i.QUOTA_ERROR_KEY):s}}})}getDailyAdvice(n,o){return l(this,null,function*(){if(!this.isAvailable())throw new Error("GEMINI_API_KEY is not configured.");let a=[];n.height!=null&&a.push(`taille ${n.height} cm`),n.weight!=null&&a.push(`poids ${n.weight} kg`),n.gender&&a.push(`genre ${n.gender}`);let c=o==="ar"?"arabe":o==="en"?"anglais":"fran\xE7ais",u=`Profil utilisateur : ${a.join(", ")||"non renseign\xE9"}. Donne exactement 2 ou 3 conseils sant\xE9 tr\xE8s courts et personnalis\xE9s pour la journ\xE9e (nutrition, eau, sommeil, activit\xE9). R\xE9ponds UNIQUEMENT dans la langue : ${c}. Pas de titre, pas de num\xE9rotation, juste des phrases courtes s\xE9par\xE9es par des retours \xE0 la ligne.`;try{let{GoogleGenerativeAI:e}=yield import("./chunk-LJEOBI3R.js"),d=(yield new e(this.apiKey).getGenerativeModel({model:"gemini-2.5-flash"}).generateContent(u)).response;return((d?d.text():"")||"").trim()||"Pas de conseil disponible."}catch(e){let t=e&&typeof e=="object"&&"message"in e?String(e.message):"";throw t.includes("429")||t.includes("quota")||t.includes("Quota exceeded")?new Error(i.QUOTA_ERROR_KEY):e}})}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275prov=m({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();export{I as a};
